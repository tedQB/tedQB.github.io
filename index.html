<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




















  
  
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5">







<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.0.0',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="卡牌大叔的博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="卡牌大叔的博客">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="卡牌大叔的博客">



  <link rel="alternate" href="/atom.xml" title="卡牌大叔的博客" type="application/atom+xml">




  <link rel="canonical" href="http://yoursite.com/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>卡牌大叔的博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">卡牌大叔的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand thee">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/02/Technical-principle/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="卡牌大叔">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卡牌大叔的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/02/Technical-principle/" class="post-title-link" itemprop="url">前端技术原理</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-02 23:42:42" itemprop="dateCreated datePublished" datetime="2019-04-02T23:42:42+08:00">2019-04-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-06-03 00:08:42" itemprop="dateModified" datetime="2019-06-03T00:08:42+08:00">2019-06-03</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="reactNative-原理"><a href="#reactNative-原理" class="headerlink" title="reactNative 原理"></a>reactNative 原理</h2><p>说明：没有Andorid，ios，c++底层分析功力无法完全通透</p>
<p>React Native桥接器初探<a href="https://segmentfault.com/a/1190000008478076" target="_blank" rel="noopener">link</a> <a href="https://www.jianshu.com/p/17d6f6c57a5c" target="_blank" rel="noopener">link</a></p>
<p><img src="/images/yl3.png">  <img src="/images/yl4.png"></p>
<ul>
<li><p>React Native 渲染</p>
<p>在 React 框架中，JSX 源码通过 React 框架最终渲染到了浏览器的真实 DOM 中，而在 React Native 框架中，JSX 源码通过 React Native 框架编译后，通过对应平台的 Bridge 实现了与原生框架的通信。如果我们在程序中调用了 React Native 提供的 API，那么 React Native 框架就通过 Bridge 调用原生框架中的方法。</p>
</li>
</ul>
<p>JavaScriptCore是一个C++ vm。使用Apple提供的JavaScriptCore框架，你可以在Objective-C或者基于C的程序中执行Javascript代码，也可以向JavaScript环境中插入一些自定义的对象。JavaScriptCore从iOS 7.0之后可以直接使用。</p>
<p>因为 React Native 的底层为 React 框架，所以如果是 UI 层的变更，那么就映射为虚拟 DOM 后进行 diff 算法，diff 算法计算出变动后的 JSON 映射文件，最终由 Native 层将此 JSON 文件映射渲染到原生 App 的页面元素上，最终实现了在项目中只需要控制 state 以及 props 的变更来引起 iOS 与 Android 平台的 UI 变更。</p>
<p>编写的 React Native代码最终会打包生成一个 main.bundle.js 文件供 App 加载，此文件可以在 App 设备本地，也可以存放于服务器上供 App 下载更新，热更新就会涉及到 main.bundle.js 位置的设置问题。</p>
<ul>
<li>优点：</li>
</ul>
<p>1.复用了 React 的思想，有利于前端开发者涉足移动端<br>2.能够利用 JavaScript 动态更新的特性，快速迭代<br>3.相比于原生平台，开发速度更快，相比于 Hybrid 框架，性能更好</p>
<ul>
<li>缺点</li>
</ul>
<ol>
<li>开发者依然要为 iOS 和 Android 两个平台提供两套不同的代。有组件是区分平台的，即使是共用组件，也会有平台独享的函数。</li>
<li>不能做到完全屏蔽 iOS 端或 Android端，前端开发者必须对原生平台有所了解。</li>
<li>由于 Objective-C 与 JavaScript 之间的切换存在固定的时间开销，所以性能必定不及原生。(比如目前的官方版本无法做到 UItableview(ListView) 的视图重用，因为滑动过程中，视图重用需要在异步线程中执行，速度太慢。这也就导致随着 Cell 数量的增加，占用的内存也线性增加。)</li>
</ol>
<ul>
<li>React Native 交互原理总结</li>
</ul>
<p>Objective-C 有 <code>JavaScript Core</code> 框架用来执行 JavaScript 代码。<br>JavaScript 通过配置表生成类，方法，参数三个元素，放入消息队列，Objective-C获取之后，<br>就可以唯一确定要调用的是哪个Objective-C函数，然后调用</p>
<h2 id="babel-原理，抽象语法树如何产生？"><a href="#babel-原理，抽象语法树如何产生？" class="headerlink" title="babel 原理，抽象语法树如何产生？"></a>babel 原理，抽象语法树如何产生？</h2><ol>
<li>将整个代码字符串分割成 语法单元  数组， 最小语法单元包含。</li>
</ol>
<ul>
<li>空白：JS中连续的空格、换行、缩进等</li>
<li>注释：行注释或块注释    </li>
<li>字符串</li>
<li>数字 16、10、8进制以及科学表达法等数字表达语法</li>
<li>标识符，没有被引号括起来的的连续字符，包含字母，_，数字，常量 true，false，if , return, function</li>
<li>运算符 +、-、*、/、&gt;、&lt;</li>
<li>括号 （ ）， 大扩招，冒号，分好，点，等等   </li>
</ul>
<p>拆分过程就是 一个字符一个字符地遍历，然后分情况讨论，整个实现方法就是顺序遍历和大量的条件判断。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="number">1</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">  alert(<span class="string">"if \"1 &gt; 0\""</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">'if'</span>     <span class="string">' '</span>       <span class="string">'('</span>    <span class="string">'1'</span>      <span class="string">' '</span>    <span class="string">'&gt;'</span>    <span class="string">' '</span>    <span class="string">')'</span>    <span class="string">' '</span>    <span class="string">'&#123;'</span></span><br><span class="line"><span class="string">'\n  '</span>   <span class="string">'alert'</span>   <span class="string">'('</span>    <span class="string">'"if \"1 &gt; 0\""'</span>    <span class="string">')'</span>    <span class="string">';'</span>    <span class="string">'\n'</span>   <span class="string">'&#125;'</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tokenizeCode</span>(<span class="params">code</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">const</span> tokens = [];</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;code.length;i++)&#123;</span><br><span class="line">      <span class="comment">//从0开始，一个字符一个字符读取</span></span><br><span class="line">      <span class="keyword">let</span> currentChar = code.charAt(i);</span><br><span class="line">      <span class="keyword">if</span>(currentChar === <span class="string">';'</span>)&#123;</span><br><span class="line">         tokens.push(&#123;</span><br><span class="line">            type:<span class="string">'sep'</span>,</span><br><span class="line">            value:<span class="string">';'</span></span><br><span class="line">         &#125;)</span><br><span class="line">         <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(currentChar === <span class="string">'('</span>|| currentChar===<span class="string">')'</span>)&#123;</span><br><span class="line">         tokens.push(&#123;</span><br><span class="line">            type:<span class="string">'parens'</span>,</span><br><span class="line">            value:currentChar</span><br><span class="line">         &#125;)</span><br><span class="line">         <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(currentChar ===<span class="string">'&#125;'</span> || currentChar===<span class="string">'&#123;'</span>)&#123;</span><br><span class="line">         tokens.push(&#123;</span><br><span class="line">            type:<span class="string">'brace'</span>,</span><br><span class="line">            value:currentChar</span><br><span class="line">         &#125;);</span><br><span class="line">         <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(currentChar ===<span class="string">'&gt;'</span> || currentChar===<span class="string">'&lt;'</span>)&#123;</span><br><span class="line">         tokens.push(&#123;</span><br><span class="line">            type:<span class="string">'operator'</span>,</span><br><span class="line">            value:currentChar</span><br><span class="line">         &#125;);</span><br><span class="line">         <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(currentChar === <span class="string">'"'</span> || currentChar ===<span class="string">'\''</span>)&#123;</span><br><span class="line">         <span class="keyword">const</span> token = &#123;</span><br><span class="line">            type:<span class="string">'string'</span>,</span><br><span class="line">            value:currentChar</span><br><span class="line">         &#125;;</span><br><span class="line">         tokens.push(token);</span><br><span class="line">         <span class="keyword">const</span> closer = currentChar;</span><br><span class="line">         <span class="keyword">let</span> escaped = <span class="literal">false</span>;</span><br><span class="line">         <span class="comment">//嵌套循环遍历，寻找字符串结尾</span></span><br><span class="line">         <span class="keyword">for</span>(i++;i&lt;code.length;i++)&#123;</span><br><span class="line">            currentChar = code.charAt(i);</span><br><span class="line">            token.value += currentChar;</span><br><span class="line">            <span class="keyword">if</span>(escaped) &#123;</span><br><span class="line">               escaped = <span class="literal">false</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>( currentChar === <span class="string">'\\'</span>)&#123;</span><br><span class="line">               escaped = <span class="literal">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>( currentChar === closer) &#123;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(<span class="regexp">/[0-9]/</span>.test(currentChar))&#123;</span><br><span class="line">         <span class="keyword">const</span> token = &#123;</span><br><span class="line">            type:<span class="string">'number'</span>,</span><br><span class="line">            value:currentChar</span><br><span class="line">         &#125;;</span><br><span class="line">         token.push(token);</span><br><span class="line">         <span class="keyword">for</span>(i++;i&lt;code.length;i++)&#123;</span><br><span class="line">            currentChar = code.charAt(i);</span><br><span class="line">            <span class="keyword">if</span>(<span class="regexp">/[0-9\.]/</span>.test(currentChar))&#123;</span><br><span class="line">               token.value += currentChar;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               i--;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(<span class="regexp">/[a-zA-Z\$\_]/</span>.test(currentChar))&#123;</span><br><span class="line">         <span class="keyword">const</span> token = &#123;</span><br><span class="line">            type:<span class="string">'identifer'</span>,</span><br><span class="line">            value:currentChar,</span><br><span class="line">         &#125;;</span><br><span class="line">         tokens.push(token)</span><br><span class="line">         <span class="keyword">for</span>(i++;i&lt;code.length;i++)&#123;</span><br><span class="line">            currentChar = code.charAt(i);</span><br><span class="line">            <span class="keyword">if</span>(<span class="regexp">/[a-zA-Z0-9\$\_]/</span>.test(currentChar))&#123;</span><br><span class="line">               token.value +=currentChar;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               i--;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(<span class="regexp">/\s/</span>.test(currentChar))&#123;</span><br><span class="line">         <span class="keyword">const</span> token = &#123;</span><br><span class="line">            type:<span class="string">'whitespace'</span>,</span><br><span class="line">            value:currentChar,</span><br><span class="line">         &#125;;</span><br><span class="line">         token.push(token);</span><br><span class="line">         <span class="keyword">for</span>(i++;i&lt;code.length;i++)&#123;</span><br><span class="line">            currentChar = code.charAt(i);</span><br><span class="line">            <span class="keyword">if</span>(<span class="regexp">/\s]/</span>.test(currentChar))&#123;</span><br><span class="line">               token.value += currentChar;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               i--;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Unexpected '</span>+currentChar);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> tokens;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>语义分析：在分析结果的基础上分析 语法单元之间的关系</li>
</ol>
<p>在编程语言的解析中有两个很相似但是又有区别的重要概念：</p>
<ul>
<li>表达式：每个表达式都会产生一个值，它可以放在任何需要一个值的地方</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = (<span class="number">5</span> + <span class="number">6</span>) / <span class="number">2</span>; <span class="comment">//表达式：(5 + 6) / 2</span></span><br><span class="line"><span class="keyword">var</span> b = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="number">25</span>;&#125;)(); <span class="comment">//表达式： (function()&#123; return 25;&#125;)()</span></span><br><span class="line">foo(a*b); <span class="comment">//表达式：a*b</span></span><br></pre></td></tr></table></figure>
<ul>
<li>语句： 是由“；（分号）”分隔的句子或命令。如果在表达式后面加上一个“；”分隔符，这就被称为“表达式语句”。它表明“只有表达式，而没有其他语法元素的语句”。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">9</span>; <span class="comment">//声明、赋值语句</span></span><br><span class="line">vloop: <span class="comment">//标签语句</span></span><br><span class="line">&#123;    <span class="comment">//其实这里大括号可以不需要的，在这里我只想向大家展示一下这种代码块结构而已</span></span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">1</span>; i&lt;<span class="number">10</span>; i++) &#123; <span class="comment">//循环语句</span></span><br><span class="line">            <span class="keyword">if</span>(i==num)&#123; <span class="comment">//条件语句</span></span><br><span class="line">                  <span class="keyword">break</span> vloop;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                  num = num - <span class="number">1</span>; </span><br><span class="line">            &#125;      </span><br><span class="line">     &#125;  </span><br><span class="line">&#125;     </span><br><span class="line"><span class="built_in">console</span>.log(num); <span class="comment">//表达式语句，输出：5</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 如何语法分析</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* stash()函数暂存当前的i，nextToken()读取一下个符号 token[i]</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* 1， 判断if语句:</span></span><br><span class="line"><span class="comment">*   如果curToken.type为标识符，为if, nextToken()紧接着读取下一个token,</span></span><br><span class="line"><span class="comment">*    如果token类型不是空格，或者不是 '（', 抛出错误</span></span><br><span class="line"><span class="comment">*   后续statement.test = nextExpression() 的一个表达式是if的判断条件，递归找出if内的表达式</span></span><br><span class="line"><span class="comment">*   nextToken()</span></span><br><span class="line"><span class="comment">*   如果后续token类型不是空格或者不是'）'，抛出错误</span></span><br><span class="line"><span class="comment">*   statement.consequent = nextStatement() (无限递归)找出下一个语句是if成立时执行的语句</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*    如果下一个符号是 else 就说明还存在 if 不成立时的逻辑</span></span><br><span class="line"><span class="comment">*   if (curToken === 'identifier' &amp;&amp; curToken.value === 'else') &#123;</span></span><br><span class="line"><span class="comment">        statement.alternative = nextStatement();</span></span><br><span class="line"><span class="comment">     &#125; else &#123;</span></span><br><span class="line"><span class="comment">           statement.alternative = null;</span></span><br><span class="line"><span class="comment">     &#125;</span></span><br><span class="line"><span class="comment">     commit(); 上一个暂存点销毁，不再需要了。</span></span><br><span class="line"><span class="comment">     return statement</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  2 判断如果是curToken.type === 'brace' &amp;&amp; curToken.value ==="&#123;"</span></span><br><span class="line"><span class="comment">  *  认为是 &#123; block代码块</span></span><br><span class="line"><span class="comment">  *  statement = &#123; type:'BlockStatement',body:[],&#125;</span></span><br><span class="line"><span class="comment">  *  statsh(); nextToken();</span></span><br><span class="line"><span class="comment">  *  if (curToken.type === 'brace' &amp;&amp; curToken.value === '&#125;') &#123; commit(); //表示代码块结束&#125;</span></span><br><span class="line"><span class="comment">  * rewind(); //回到原来位置</span></span><br><span class="line"><span class="comment">        statement.body.push(nextStatement()); //递归，寻找block代码块中的语句or表达式</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parse</span> (<span class="params">tokens</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">let</span> i = <span class="number">-1</span>;</span><br><span class="line">   <span class="keyword">let</span> curToken;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">nextStatement</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      stash();</span><br><span class="line">      nextToken();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(curToken.type === <span class="string">'identifier'</span> &amp;&amp; curToken.value ===<span class="string">'if'</span>)&#123;</span><br><span class="line">         <span class="comment">//解析 if 语句</span></span><br><span class="line">         <span class="keyword">const</span> statement = &#123;</span><br><span class="line">            type:<span class="string">'IfStatement'</span>,</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         nextToken();</span><br><span class="line">         <span class="keyword">if</span> (curToken.type !== <span class="string">'parens'</span> || curToken.value !== <span class="string">'('</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected ( after if'</span>);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 后续的一个表达式是 if 的判断条件</span></span><br><span class="line">         statement.test = nextExpression();</span><br><span class="line">         <span class="comment">// 判断条件之后必须是 )</span></span><br><span class="line">         nextToken();</span><br><span class="line">         <span class="keyword">if</span>(curToken.type!==<span class="string">'parens'</span> || curToken.value!==<span class="string">')'</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span>  <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected ) after if test expression'</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         statement.consequent = nextStatement();</span><br><span class="line">         <span class="keyword">if</span>(curToken === <span class="string">'identifier'</span> &amp;&amp; curToken.value ===<span class="string">'else'</span>)&#123;</span><br><span class="line">            statement.alternative = nextStatement();</span><br><span class="line">         &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            statement.alternative = <span class="literal">null</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         commit();</span><br><span class="line">         <span class="keyword">return</span> statement;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(curToken.type ===<span class="string">'brace'</span> &amp;&amp; curToken.value ===<span class="string">'&#123;'</span>)&#123;</span><br><span class="line">         <span class="comment">// 以 &#123; 开头表示是个代码块，我们暂不考虑JSON语法的存在</span></span><br><span class="line">         <span class="keyword">const</span> statement = &#123;</span><br><span class="line">            type: <span class="string">'BlockStatement'</span>,</span><br><span class="line">            body: [],</span><br><span class="line">         &#125;;</span><br><span class="line">         <span class="keyword">while</span> (i&lt;tokens.length)&#123;</span><br><span class="line">            <span class="comment">// 检查下一个符号是不是 &#125;</span></span><br><span class="line">            stash();</span><br><span class="line">            nextToken();</span><br><span class="line">            <span class="keyword">if</span>(curToken.type===<span class="string">'brace'</span>&amp;&amp;curToken.value ===<span class="string">"&#125;"</span>)&#123;</span><br><span class="line">               commit();</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            rewind();</span><br><span class="line">            statement.body.push(nextStatement());</span><br><span class="line">         &#125;</span><br><span class="line">         commit();</span><br><span class="line">         <span class="keyword">return</span> statement;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      rewind();</span><br><span class="line">      <span class="keyword">const</span> statement = &#123;</span><br><span class="line">         type:<span class="string">'ExpressionStatement'</span>,</span><br><span class="line">         expression:nextExpression(),</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">if</span>(statement.expression)&#123;</span><br><span class="line">         nextToken();</span><br><span class="line">         <span class="keyword">if</span> (curToken.type !== <span class="string">'EOF'</span> &amp;&amp; curToken.type !== <span class="string">'sep'</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Missing ; at end of expression'</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> statement;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取下一个表达式</span></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">nextExpression</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      nextToken();</span><br><span class="line">      <span class="keyword">if</span> (curToken.type === <span class="string">'identifier'</span>) &#123;</span><br><span class="line">         <span class="keyword">const</span> identifier = &#123;</span><br><span class="line">            type: <span class="string">'Identifier'</span>,</span><br><span class="line">            name: curToken.value,</span><br><span class="line">         &#125;;</span><br><span class="line">         stash();</span><br><span class="line">         nextToken();</span><br><span class="line">         <span class="keyword">if</span> (curToken.type === <span class="string">'parens'</span> &amp;&amp; curToken.value === <span class="string">'('</span>) &#123;</span><br><span class="line">            <span class="comment">// 如果一个标识符后面紧跟着 ( ，说明是个函数调用表达式</span></span><br><span class="line">            <span class="keyword">const</span> expr = &#123;</span><br><span class="line">               type: <span class="string">'CallExpression'</span>,</span><br><span class="line">               caller: identifier,</span><br><span class="line">               <span class="built_in">arguments</span>: [],</span><br><span class="line">            &#125;;</span><br><span class="line">            stash();</span><br><span class="line">            nextToken();</span><br><span class="line">            <span class="keyword">if</span> (curToken.type === <span class="string">'parens'</span> &amp;&amp; curToken.value === <span class="string">')'</span>) &#123;</span><br><span class="line">               <span class="comment">// 如果下一个符合直接就是 ) ，说明没有参数</span></span><br><span class="line">               commit();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="comment">// 读取函数调用参数</span></span><br><span class="line">               rewind();</span><br><span class="line">               <span class="keyword">while</span> (i &lt; tokens.length) &#123;</span><br><span class="line">                  <span class="comment">// 将下一个表达式加到arguments当中</span></span><br><span class="line">                  expr.arguments.push(nextExpression());</span><br><span class="line">                  nextToken();</span><br><span class="line">                  <span class="comment">// 遇到 ) 结束</span></span><br><span class="line">                  <span class="keyword">if</span> (curToken.type === <span class="string">'parens'</span> &amp;&amp; curToken.value === <span class="string">')'</span>) &#123;</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="comment">// 参数间必须以 , 相间隔</span></span><br><span class="line">                  <span class="keyword">if</span> (curToken.type !== <span class="string">'comma'</span> &amp;&amp; curToken.value !== <span class="string">','</span>) &#123;</span><br><span class="line">                     <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected , between arguments'</span>);</span><br><span class="line">                  &#125;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            commit();</span><br><span class="line">            <span class="keyword">return</span> expr;</span><br><span class="line">         &#125;</span><br><span class="line">         rewind();</span><br><span class="line">         <span class="keyword">return</span> identifier;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (curToken.type === <span class="string">'number'</span> || curToken.type === <span class="string">'string'</span>) &#123;</span><br><span class="line">         <span class="comment">// 数字或字符串，说明此处是个常量表达式</span></span><br><span class="line">         <span class="keyword">const</span> literal = &#123;</span><br><span class="line">            type: <span class="string">'Literal'</span>,</span><br><span class="line">            value: <span class="built_in">eval</span>(curToken.value),</span><br><span class="line">         &#125;;</span><br><span class="line">         <span class="comment">// 但如果下一个符号是运算符，那么这就是个双元运算表达式</span></span><br><span class="line">         <span class="comment">// 此处暂不考虑多个运算衔接，或者有变量存在</span></span><br><span class="line">         stash();</span><br><span class="line">         nextToken();</span><br><span class="line">         <span class="keyword">if</span> (curToken.type === <span class="string">'operator'</span>) &#123;</span><br><span class="line">            commit();</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">               type: <span class="string">'BinaryExpression'</span>,</span><br><span class="line">               left: literal,</span><br><span class="line">               right: nextExpression(),</span><br><span class="line">            &#125;;</span><br><span class="line">         &#125;</span><br><span class="line">         rewind();</span><br><span class="line">         <span class="keyword">return</span> literal;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (curToken.type !== <span class="string">'EOF'</span>) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Unexpected token '</span> + curToken.value);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">nextToken</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">do</span>&#123;</span><br><span class="line">         i++;</span><br><span class="line">         curToken = tokens[i] || &#123; <span class="attr">type</span>:<span class="string">'EOF'</span> &#125;</span><br><span class="line">      &#125;<span class="keyword">while</span> (curToken.type===<span class="string">'whitespace'</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">const</span> stashStack = [];</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">stash</span>(<span class="params">cb</span>)</span>&#123;</span><br><span class="line">      stashStack.push(i);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">rewind</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      i = stashStack.pop();</span><br><span class="line">      curToken = tokens[i];</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">commit</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      stashStack.pop()</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">const</span> ast = &#123;</span><br><span class="line">      type:<span class="string">'Program'</span>,</span><br><span class="line">      body:[]</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">while</span> (i&lt;tokens.length)&#123;</span><br><span class="line">      <span class="keyword">const</span> statement = nextStatement();</span><br><span class="line">      <span class="keyword">if</span>(!statement)&#123; <span class="keyword">break</span>; &#125;</span><br><span class="line">      ast.body.push(statement);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> ast;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="webpack-原理"><a href="#webpack-原理" class="headerlink" title="webpack 原理"></a>webpack 原理</h2><p>实现一个简单的webpack <a href="https://segmentfault.com/a/1190000015225750" target="_blank" rel="noopener">link</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mainFile = parse(config.entry, <span class="literal">true</span>) <span class="comment">//babylon.parse 返回入口js文件的AST抽象语法树，依赖</span></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">    fileName,</span><br><span class="line">    dependence: getDependence(ast),</span><br><span class="line">    code: getTranslateCode(ast),</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> queue = getQueue(mainFile) <span class="comment">//分析递归主文件依赖，返回文件依赖的字面量树。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'queue'</span>,queue);</span><br><span class="line"><span class="keyword">return</span> bundle(queue) ;<span class="comment">//打包所有js到一个文件。</span></span><br><span class="line"></span><br><span class="line">===== </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> babylon = <span class="built_in">require</span>(<span class="string">'babylon'</span>);</span><br><span class="line"><span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">'babel-traverse'</span>).default;</span><br><span class="line"><span class="keyword">const</span> &#123;transformFromAst&#125; = <span class="built_in">require</span>(<span class="string">'babel-core’);</span></span><br><span class="line"><span class="string">const loaderUtils = require('</span>loader-utils<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">let config = &#123;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//fs.readFileSync获取源代码，在转换成ast之前执行loader </span></span><br><span class="line"><span class="string">function getSource(modulePath)&#123;</span></span><br><span class="line"><span class="string">    try&#123;</span></span><br><span class="line"><span class="string">        let rules = this.config.module.rules</span></span><br><span class="line"><span class="string">        const content = fs.readFileSync(modulePath, '</span>utf<span class="number">-8</span><span class="string">') //读取源文件</span></span><br><span class="line"><span class="string">        for(let i = 0;i&lt;rules.length;i++)&#123;</span></span><br><span class="line"><span class="string">            let &#123;test, use &#125; = rules[i]</span></span><br><span class="line"><span class="string">            let len = use.length -1</span></span><br><span class="line"><span class="string">            if(test.test(modulePath))&#123;</span></span><br><span class="line"><span class="string">                //递归处理所有loader</span></span><br><span class="line"><span class="string">                function loopLoader() &#123;</span></span><br><span class="line"><span class="string">                    let loader = require(use[len--])</span></span><br><span class="line"><span class="string">                    let content = loader(content);</span></span><br><span class="line"><span class="string">                    if(len&gt;=0)&#123;</span></span><br><span class="line"><span class="string">                        loopLoader()</span></span><br><span class="line"><span class="string">                    &#125;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                loopLoader()</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        return content</span></span><br><span class="line"><span class="string">    &#125;catch (e) &#123;</span></span><br><span class="line"><span class="string">        throw new Error(`获取数据错误 : $&#123;modulePath&#125;`)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/**</span></span><br><span class="line"><span class="string"> * 获取文件，解析成ast语法</span></span><br><span class="line"><span class="string"> * @param filename</span></span><br><span class="line"><span class="string"> * @returns &#123;*&#125;</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string">function getAst (source) &#123;</span></span><br><span class="line"><span class="string">  const content = source</span></span><br><span class="line"><span class="string">  return babylon.parse(content, &#123;</span></span><br><span class="line"><span class="string">    sourceType: '</span><span class="built_in">module</span><span class="string">',</span></span><br><span class="line"><span class="string">  &#125;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function getDependence (ast) &#123;</span></span><br><span class="line"><span class="string">  let dependencies = []</span></span><br><span class="line"><span class="string">  traverse(ast, &#123;</span></span><br><span class="line"><span class="string">    ImportDeclaration: (&#123;node&#125;) =&gt; &#123;</span></span><br><span class="line"><span class="string">      dependencies.push(node.source.value);</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">  console.log('</span>dependencies<span class="string">',dependencies);</span></span><br><span class="line"><span class="string">  return dependencies</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/**</span></span><br><span class="line"><span class="string"> * 编译</span></span><br><span class="line"><span class="string"> * @param ast</span></span><br><span class="line"><span class="string"> * @returns &#123;*&#125;</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string">function getTranslateCode(ast) &#123;</span></span><br><span class="line"><span class="string">  const &#123;code&#125; = transformFromAst(ast, null, &#123;</span></span><br><span class="line"><span class="string">    presets: ['</span>env<span class="string">']</span></span><br><span class="line"><span class="string">  &#125;);</span></span><br><span class="line"><span class="string">  console.log('</span>code<span class="string">',code);</span></span><br><span class="line"><span class="string">  return code</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/**</span></span><br><span class="line"><span class="string"> * 生成完整的文件依赖关系映射</span></span><br><span class="line"><span class="string"> * @param fileName</span></span><br><span class="line"><span class="string"> * @param entry</span></span><br><span class="line"><span class="string"> * @returns &#123;&#123;fileName: *, dependence, code: *&#125;&#125;</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string">function parse(fileName, entry) &#123;</span></span><br><span class="line"><span class="string">  let filePath = fileName.indexOf('</span>.js<span class="string">') === -1 ? fileName + '</span>.js<span class="string">' : fileName</span></span><br><span class="line"><span class="string">  let dirName = entry ? '</span><span class="string">' : path.dirname(config.entry)</span></span><br><span class="line"><span class="string">  let absolutePath = path.join(dirName, filePath)</span></span><br><span class="line"><span class="string">  let source =this.getSource(absolutePath)</span></span><br><span class="line"><span class="string">  const ast = getAst(source)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  return &#123;</span></span><br><span class="line"><span class="string">    fileName,</span></span><br><span class="line"><span class="string">    dependence: getDependence(ast),</span></span><br><span class="line"><span class="string">    code: getTranslateCode(ast),</span></span><br><span class="line"><span class="string">  &#125;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/**</span></span><br><span class="line"><span class="string"> * 获取深度队列依赖关系</span></span><br><span class="line"><span class="string"> * @param main</span></span><br><span class="line"><span class="string"> * @returns &#123;*[]&#125;</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string">function getQueue(main) &#123;</span></span><br><span class="line"><span class="string">  let queue = [main]</span></span><br><span class="line"><span class="string">  for (let asset of queue) &#123;</span></span><br><span class="line"><span class="string">    asset.dependence.forEach(function (dep) &#123;</span></span><br><span class="line"><span class="string">      let child = parse(dep)</span></span><br><span class="line"><span class="string">      queue.push(child)</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  return queue</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function bundle(queue) &#123;</span></span><br><span class="line"><span class="string">  let modules = '</span><span class="string">'</span></span><br><span class="line"><span class="string">  queue.forEach(function (mod) &#123;</span></span><br><span class="line"><span class="string">    modules += `'</span>$&#123;mod.fileName&#125;<span class="string">': function (require, module, exports) &#123; $&#123;mod.code&#125; &#125;,`</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  const result = `</span></span><br><span class="line"><span class="string">    (function(modules) &#123;</span></span><br><span class="line"><span class="string">      function require(fileName) &#123;</span></span><br><span class="line"><span class="string">        const fn = modules[fileName];</span></span><br><span class="line"><span class="string">        const module = &#123; exports : &#123;&#125; &#125;;</span></span><br><span class="line"><span class="string">        fn(require, module, module.exports);</span></span><br><span class="line"><span class="string">        return module.exports;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      require('</span>$&#123;config.entry&#125;<span class="string">');</span></span><br><span class="line"><span class="string">    &#125;)(&#123;$&#123;modules&#125;&#125;)</span></span><br><span class="line"><span class="string">  `;</span></span><br><span class="line"><span class="string">  // We simply return the result, hurray! :)</span></span><br><span class="line"><span class="string">  return result;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//option tinypack.config.js</span></span><br><span class="line"><span class="string">function bundleFile(option) &#123;</span></span><br><span class="line"><span class="string">  console.log(option)</span></span><br><span class="line"><span class="string">  config = option</span></span><br><span class="line"><span class="string">  let mainFile = parse(config.entry, true) //返回入口js文件的AST抽象语法树，依赖</span></span><br><span class="line"><span class="string">  let queue = getQueue(mainFile) //递归主文件依赖，返回文件依赖的字面量树。</span></span><br><span class="line"><span class="string">  console.log('</span>queue<span class="string">',queue);</span></span><br><span class="line"><span class="string">  return bundle(queue) ;//打包所有js到一个文件。</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">module.exports = bundleFile</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>
<h2 id="DIFF-算法实现-原理"><a href="#DIFF-算法实现-原理" class="headerlink" title="DIFF 算法实现 原理"></a>DIFF 算法实现 原理</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;StateEnums,isString, move &#125; <span class="keyword">from</span> ‘./util’</span><br><span class="line"><span class="keyword">import</span> Element <span class="keyword">from</span> ‘./element’</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">diff</span>(<span class="params">oldDomTree, newDomTree</span>)</span>&#123; </span><br><span class="line">    <span class="keyword">let</span> patches = &#123; &#125; <span class="comment">//记录差异</span></span><br><span class="line">    dfs(oldDomTree, newDomTree, <span class="number">0</span>, patches)</span><br><span class="line">    <span class="keyword">return</span> patches</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//树递归</span></span><br><span class="line"><span class="comment">//①，比较新旧节点,</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dfs</span>(<span class="params">oldNode, newNode, index, patches</span>)</span>&#123; </span><br><span class="line">    <span class="keyword">let</span> curPatches = [ ] <span class="comment">//用于保存子树更改</span></span><br><span class="line">    <span class="comment">// 需要判断三种情况</span></span><br><span class="line">    <span class="comment">/*1.没有新的节点，什么都不做</span></span><br><span class="line"><span class="comment">      2.新的节点 tagName和 key(可能没有) 和旧的相同，开始比较属性是否相同，如果不同则入栈属性改变状态，</span></span><br><span class="line"><span class="comment">      (diffProps 比较属性。</span></span><br><span class="line"><span class="comment">         * 遍历旧节点的属性key，如果旧节点属性key 新节点没有这个key，入栈属prop key (说明删除了)</span></span><br><span class="line"><span class="comment">         * 遍历新节点尚属性key,若旧节点存在key,比较新旧vlue值，oldprops[key] !== 新节点props[key], 入栈 新节点key,新节点 value（说明添加了key）</span></span><br><span class="line"><span class="comment">     若不存在oldProps[key], 入栈新 &#123;prop:key,value:newProps&#125;     </span></span><br><span class="line"><span class="comment">      )</span></span><br><span class="line"><span class="comment">      开始遍历子树, diffChildren(oldNode.children, newNode.children, index, patches)&#123; </span></span><br><span class="line"><span class="comment">         let &#123; changes, list &#125; = listDiff ( oldChild, newChild, index, patches )</span></span><br><span class="line"><span class="comment">     //判断列表差异算法实现 Vitual Dom核心算法</span></span><br><span class="line"><span class="comment">    /*</span></span><br><span class="line"><span class="comment">     * 迭代oldList,找到oldlist的节点key,声明一个临时栈oldlistTemp，声明change栈</span></span><br><span class="line"><span class="comment">     如果oldList节点存在的key newList不存在，说明oldList此节点key被删除，入栈null到oldKeyTemp里</span></span><br><span class="line"><span class="comment">     如果都存在key相当说明 子树上存在相同节点，只用对比两个节点是否需要运动, 入栈key到oldKeyTemp里</span></span><br><span class="line"><span class="comment">     * 迭代oldKeyTemp, 发现有null，入栈change.push(&#123;type:StateEnums.Remove, index:i&#125;)</span></span><br><span class="line"><span class="comment">     * 迭代newlist,找到节点key,</span></span><br><span class="line"><span class="comment">    如果存在oldKeyTemp[key]，说明这个节点从旧到新没有发生操作，</span></span><br><span class="line"><span class="comment">      但需要判断节点树层级，如果index!=i 入栈 changes.push(&#123; type:StateEnums.Move, from:index,to:i &#125;)，移动节点</span></span><br><span class="line"><span class="comment">    如果不存在oldkeyTemp.indexOf(key) === -1, 说明这个节点是个新节点，</span></span><br><span class="line"><span class="comment">    入栈 changes.push(&#123; type:StateEnums.Insert, node:item, index:i&#125;) oldKeyTemp添加此key</span></span><br><span class="line"><span class="comment">      listDiff方法返回 &#123; changes, oldListTemp &#125;</span></span><br><span class="line"><span class="comment">      </span></span><br><span class="line"><span class="comment">      diffChildren中拿到change,list, 合并更改到patches里。 再次比较新旧节点，如果新节点存在字子节点，递归dfs重复上面过程</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    dfs返回所有节点的替换，删除，移动信息。</span></span><br><span class="line"><span class="comment">   </span></span><br><span class="line"><span class="comment">      </span></span><br><span class="line"><span class="comment">   3.新的节点的tagName和 ‘key’ 和旧的不同，就替换所有树，不需遍历旧节点子元素，因为整个节点都被替换掉了，入栈节点替换状态</span></span><br><span class="line"><span class="comment">      </span></span><br><span class="line"><span class="comment">   最后调用patch(root, diffs), 应用更新，由于更新用的都是无关dom操作的api,完成替换。</span></span><br><span class="line"><span class="comment">   StateEnums.ChangeProps/remove/move/insert</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">if</span>(!newNode)&#123; &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(newNode.tag===oldNode.tag &amp;&amp; newNode.key === oldNode.key)&#123; </span><br><span class="line">        <span class="comment">//判断属性是否变更</span></span><br><span class="line">        <span class="keyword">let</span> props = diffProps(oldNode.props, newNode.props)</span><br><span class="line">        <span class="keyword">if</span>(props.length) curPatches.push(&#123; <span class="attr">type</span>:StateEnums.ChangeProps, props &#125;)</span><br><span class="line">        <span class="comment">//遍历子树</span></span><br><span class="line">        diffChildren(oldNode.children, newNode.children, index, patches )</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="comment">//节点不同，需要替换</span></span><br><span class="line">        curPatches.push(&#123; <span class="attr">type</span>:StateEnums.Replace, <span class="attr">node</span>:newNode &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(curPatches.length)&#123; </span><br><span class="line">        <span class="keyword">if</span>(patches[index])&#123; </span><br><span class="line">            patches[index] = patches[index].concat[curPatches]</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">            patches[index] = curPatches </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断属性的更改</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   1 遍历旧节点的属性key，如果旧节点属性key 新节点没有这个key，入栈属prop key (说明删除了)</span></span><br><span class="line"><span class="comment">   2 遍历新节点尚属性key,若旧节点存在key,比较新旧vlue值，oldprops[key] !== 新节点props[key], 入栈 新节点key,新节点 value（说明添加了key）</span></span><br><span class="line"><span class="comment">     若不存在oldProps[key], 入栈新 &#123;prop:key,value:newProps&#125;   </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">diffProps</span> (<span class="params">oldProps, newProps</span>)</span>&#123; </span><br><span class="line">    <span class="keyword">let</span> change = []</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> key <span class="keyword">in</span> oldProps) &#123; </span><br><span class="line">        <span class="keyword">if</span>(oldProps.hasOwnProperty(key) &amp;&amp;!newProps[key])&#123; </span><br><span class="line">            change.push(&#123; <span class="attr">prop</span>:key &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> key <span class="keyword">in</span> newProps)&#123; </span><br><span class="line">        <span class="keyword">if</span>(newProps.hasOwnProperty(key))&#123; </span><br><span class="line">            <span class="keyword">const</span> prop = newProps[key]</span><br><span class="line">            <span class="keyword">if</span>(oldProps[key] &amp;&amp; oldProps[key]!==newProps[key])&#123; </span><br><span class="line">                change.push(&#123; <span class="attr">prop</span>:key, <span class="attr">value</span>:newProps[key] &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!oldProps[key])&#123; </span><br><span class="line">            change.push(&#123; <span class="attr">prop</span>:key, <span class="attr">value</span>:newProps &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> change</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//遍历子元素打标识，判断两个列表差异</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    listDiff 拿到</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">diffChildren</span> (<span class="params">oldChild,newChild,index,patches</span>)</span>&#123; </span><br><span class="line">    <span class="keyword">let</span> &#123; changes, list &#125; = listDiff(oldChild, newChild, index, patches)</span><br><span class="line">    <span class="keyword">if</span>(changes.length)&#123; </span><br><span class="line">        <span class="keyword">if</span>(patches[index])&#123; <span class="comment">//合并更改</span></span><br><span class="line">            patches[index] = patches[index].concat(changes)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">            patches[index] = changes </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">let</span> last = <span class="literal">null</span></span><br><span class="line">    oldChild &amp;&amp; </span><br><span class="line">        oldChild.forEach(<span class="function">(<span class="params">item,i</span>)=&gt;</span>&#123; <span class="comment">//递归看是否仍然有子节点，然后进行dfs操作。</span></span><br><span class="line">            <span class="keyword">let</span> child = item &amp;&amp; item.children</span><br><span class="line">            <span class="keyword">if</span>(child)&#123; </span><br><span class="line">                index = last &amp;&amp; last.children? index+last.children.length+<span class="number">1</span>:index+<span class="number">1</span></span><br><span class="line">                <span class="keyword">let</span> keyIndex = list.indexOf(item.key)</span><br><span class="line">                <span class="keyword">let</span> node = newChild[keyIndex]</span><br><span class="line">                <span class="comment">// 只遍历新旧中都存在的节点，其他新增或者删除的没必要遍历</span></span><br><span class="line">                <span class="keyword">if</span>(node)&#123; </span><br><span class="line">                    dfs(item, node, index, patches) </span><br><span class="line">                &#125;</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                index+=<span class="number">1</span></span><br><span class="line">            </span><br><span class="line">            last = item</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断列表差异算法实现 Vitual Dom核心算法</span></span><br><span class="line"><span class="comment">/* 1 迭代oldList,找到oldlist的节点key,声明一个临时栈oldlistTemp，声明change栈</span></span><br><span class="line"><span class="comment">     如果oldList节点存在的key newList不存在，说明oldList此节点key被删除，入栈null到oldKeyTemp里</span></span><br><span class="line"><span class="comment">     如果都存在key相当说明 子树上存在相同节点，只用对比两个节点是否需要运动, 入栈key到oldKeyTemp里</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   2 迭代oldKeyTemp, 发现有null，入栈change.push(&#123;type:StateEnums.Remove, index:i&#125;)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   3 迭代newlist,找到节点key,</span></span><br><span class="line"><span class="comment">    如果存在oldKeyTemp[key]，说明这个节点从旧到新没有发生操作，</span></span><br><span class="line"><span class="comment">     但需要判断节点树层级，如果index!=i 入栈 changes.push(&#123; type:StateEnums.Move, from:index,to:i &#125;)，移动节点</span></span><br><span class="line"><span class="comment">    如果不存在oldkeyTemp.indexOf(key) === -1, 说明这个节点是个新节点，</span></span><br><span class="line"><span class="comment">    入栈 changes.push(&#123; type:StateEnums.Insert, node:item, index:i&#125;) oldKeyTemp添加此key</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">listDiff方法返回 &#123; changes, oldListTemp &#125;</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">listDiff</span> (<span class="params">oldList, newList, index, patches</span>)</span>&#123; </span><br><span class="line">    <span class="keyword">let</span> oldKeys = getKeys(oldList)</span><br><span class="line">    <span class="keyword">let</span> newKeys = getKeys(newList)</span><br><span class="line">    <span class="keyword">let</span> change = [ ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span>  oldkeyTemp = [ ]</span><br><span class="line">    oldList &amp;&amp; </span><br><span class="line">        oldList.forEach(<span class="function"><span class="params">item</span>=&gt;</span>&#123; </span><br><span class="line">            <span class="keyword">let</span> key = item.key</span><br><span class="line">            <span class="keyword">if</span>(isString(item)) &#123; key = item &#125; </span><br><span class="line">            <span class="keyword">let</span> index = newKeys.indexOf(key)</span><br><span class="line">            <span class="keyword">if</span>( index === <span class="number">-1</span>)&#123; </span><br><span class="line">                oldkeyTemp.push(<span class="literal">null</span>)  <span class="comment">//newList不存在key， 说明oldList此节点k被删除，入栈null</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> oldkeyTemp.push(key) <span class="comment">//把newlist, oldlist 都存在的key保留在数组里。</span></span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="comment">//遍历变更后的数组,因为删除数组元素是会更改索引的,所有从后往前删可以保证索引不变, </span></span><br><span class="line">    <span class="comment">//找到null节点，入栈删除操作</span></span><br><span class="line">    <span class="keyword">let</span> length = oldkeyTemp.length</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = length<span class="number">-1</span>; i&gt;<span class="number">0</span>;i--) &#123; </span><br><span class="line">        <span class="keyword">if</span>(!oldkeyTemp[i])&#123; </span><br><span class="line">            oldkeyTemp.splice(i,<span class="number">1</span>); <span class="comment">//把空节点删掉。</span></span><br><span class="line">            changes.push(&#123; <span class="attr">type</span>:StateEnums.Remove, <span class="attr">index</span>:i &#125;)    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//遍历新的list, 判断是否有节点新增或移动， 同时也对 list 做节点新增和移动节点操作</span></span><br><span class="line">    newList &amp;&amp; </span><br><span class="line">        newList.forEach(<span class="function">(<span class="params">item,i</span>)=&gt;</span>&#123; </span><br><span class="line">            <span class="keyword">let</span> key = item.key</span><br><span class="line">            <span class="keyword">if</span>(isString(item)) &#123; key = item &#125;</span><br><span class="line">            <span class="comment">//寻找旧的children中是否含有当前节点</span></span><br><span class="line">            <span class="keyword">let</span> index = oldkeyTemp.indexOf(key)</span><br><span class="line">            <span class="comment">//如果没有找到新节点，说明此key是一个新的节点，需要插入</span></span><br><span class="line">            <span class="keyword">if</span>(index === <span class="number">-1</span> || key== <span class="literal">null</span>)&#123; </span><br><span class="line">                changes.push(&#123; </span><br><span class="line">                    type:StateEnums.Insert,</span><br><span class="line">                    node:item,</span><br><span class="line">                    index:i</span><br><span class="line">                &#125;)</span><br><span class="line">                oldListTemp.splice(i,<span class="number">0</span>,key) </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                <span class="comment">//找到了，需要判断是否需要移动</span></span><br><span class="line">                <span class="keyword">if</span>(index!==i)&#123; </span><br><span class="line">                  changes.push(&#123; </span><br><span class="line">                    type:StateEnums.Move,</span><br><span class="line">                    <span class="keyword">from</span>:index,</span><br><span class="line">                    to:i</span><br><span class="line">                  &#125;)</span><br><span class="line">                  move(list, index, i)   </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;   </span><br><span class="line">        &#125;)</span><br><span class="line">     <span class="keyword">return</span> &#123; changes, oldListTemp &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getKeys</span> (<span class="params">list</span>)</span>&#123; </span><br><span class="line">    <span class="keyword">let</span> keys = [ ]</span><br><span class="line">    <span class="keyword">let</span> text</span><br><span class="line">    list &amp;&amp; list.forEach(<span class="function"><span class="params">item</span>=&gt;</span>&#123; </span><br><span class="line">        <span class="keyword">let</span> key</span><br><span class="line">        <span class="keyword">if</span>(isString(item)) &#123; key = [item] &#125; <span class="comment">//如果item本身为文本，将文本作为单数组 key</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (item <span class="keyword">instanceof</span> Element) &#123; key = item.key &#125;</span><br><span class="line">        keys.push(key)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> keys </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//渲染差异 深度遍历树，将需要的变更操作取出来。 局部更新DOM</span></span><br><span class="line"><span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">patch</span>(<span class="params">node,patchs</span>)</span>&#123; </span><br><span class="line">    <span class="keyword">let</span> changes = patchs[index]</span><br><span class="line">    <span class="keyword">let</span> childNodes = node &amp;&amp; node.childNodes</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!childNodes) index += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span>(changes &amp;&amp; changes.length &amp;&amp; patchs[index]) &#123; changeDom (node, changes) &#125;</span><br><span class="line">    <span class="keyword">let</span> last = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span>(childNodes &amp;&amp; childNode.length)&#123; </span><br><span class="line">        childNodes.forEach(<span class="function">(<span class="params">item,i</span>) =&gt;</span> &#123; </span><br><span class="line">            index = last &amp;&amp; last.children ? index +last.children.length+<span class="number">1</span>:index+<span class="number">1</span></span><br><span class="line">            patch(item, patchs);</span><br><span class="line">            last = item</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeDom</span> (<span class="params"> node, changes, noChild</span>) </span>&#123; </span><br><span class="line">    changes &amp;&amp; </span><br><span class="line">        changes.forEach(<span class="function"><span class="params">change</span> =&gt;</span>&#123; </span><br><span class="line">            <span class="keyword">let</span> &#123;type&#125; = change            </span><br><span class="line">            swtich(type) &#123; </span><br><span class="line">                <span class="keyword">case</span> StateEnums.ChangeProps:</span><br><span class="line">                    <span class="keyword">let</span> &#123; props &#125; = change</span><br><span class="line">                    props.forEach( <span class="function"><span class="params">item</span> =&gt;</span> &#123; </span><br><span class="line">                            <span class="keyword">if</span>(item.value) &#123; node.setAttribute(item.prop, item.value) &#125;</span><br><span class="line">                            <span class="keyword">else</span> &#123; node.removeAttribute(item.prop) &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> StateEnums.Remove:</span><br><span class="line">                    node.childNodes[change.index].remove();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> StateEnums.Insert:</span><br><span class="line">                    <span class="keyword">let</span> dom</span><br><span class="line">                    <span class="keyword">if</span>(isString(change.node))&#123; </span><br><span class="line">                        dom = <span class="built_in">document</span>.createTextNode(change.node)</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>( change.node <span class="keyword">instanceof</span> Element)&#123; </span><br><span class="line">                        dom = change.node.create()</span><br><span class="line">                    &#125;      </span><br><span class="line">                    node.insertBefore( dom, nodeChildNodes[change.index]) </span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> StateEnums.Move:</span><br><span class="line">                    <span class="keyword">let</span> fromNode = node.childNodes[change.from]</span><br><span class="line">                    <span class="keyword">let</span> toNode = node.childNodes[change.to]</span><br><span class="line">                    <span class="keyword">let</span> cloneFromNode = fromNode.cloneNode(<span class="literal">true</span>)</span><br><span class="line">                    <span class="keyword">let</span> cloneToNode = toNode.cloneNode(<span class="literal">true</span>)</span><br><span class="line">                    node.replaceChild(cloneFromNode,toNode)</span><br><span class="line">                    node.replaceChild(cloneToNode,fromNode)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> test4 = <span class="keyword">new</span> Element(<span class="string">'div'</span>, &#123; <span class="attr">class</span>: <span class="string">'my-div'</span> &#125;, [<span class="string">'test4’],’key4'</span>)</span><br><span class="line"><span class="keyword">let</span> test5 = <span class="keyword">new</span> Element(<span class="string">'ul'</span>, &#123; <span class="attr">class</span>: <span class="string">'my-div'</span> &#125;, [<span class="string">'test5’],’key5'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> test1 = <span class="keyword">new</span> Element(<span class="string">'div'</span>, &#123; <span class="attr">class</span>: <span class="string">'my-div'</span> &#125;, [test4], ‘key1<span class="string">')</span></span><br><span class="line"><span class="string">let test2 = new Element('</span>div<span class="string">', &#123; id: '</span><span class="number">11</span><span class="string">' &#125;, [test5, test4], ‘key2'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> root = test1.render()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> patchs = diff(test1, test2)</span><br><span class="line"><span class="built_in">console</span>.log(patchs)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'开始更新'</span>)</span><br><span class="line">  patch(root, patchs)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'结束更新'</span>)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>
<p>diff的不足与待优化的地方</p>
<p><img src="/images/yl2.png"><br>看图的 D，此时D不移动，但它的index是最大的，导致更新lastIndex=3，从而使得其他元素A,B,C的index&lt;lastIndex，导致A,B,C都要去移动。<br>理想情况是只移动D，不移动A,B,C。因此，在开发过程中，尽量减少类似将最后一个节点移动到列表首部的操作，当节点数量过大或更新操作过于频繁时，会影响React的渲染性能。</p>
<h2 id="viturl-Dom实现"><a href="#viturl-Dom实现" class="headerlink" title="viturl Dom实现"></a>viturl Dom实现</h2><p>Virtual Dom实现<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建节点  </span></span><br><span class="line"><span class="comment">//实现逻辑： </span></span><br><span class="line"><span class="number">1</span> 创建一个el空节点，遍历props,添加为el属性，如果存在key属性，添加key属性到le上</span><br><span class="line"><span class="number">2</span> 判断child参数是否存在，迭代child，判断child的每项是虚拟El节点则递归创建节点方法，不是El节点肯定为Text节点，</span><br><span class="line">创建Text文本节点。 最后统一插入到el空节点下， 递归完成返回el节点</span><br><span class="line"></span><br><span class="line">&lt;ul id=<span class="string">'list'</span>&gt;</span><br><span class="line">  &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">'item'</span>&gt;Item <span class="number">1</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">  &lt;li class='item'&gt;Item 2&lt;/</span>li&gt;</span><br><span class="line">  &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">'item'</span>&gt;Item <span class="number">3</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">&lt;/u</span>l&gt;</span><br><span class="line"><span class="keyword">var</span> ul = el(<span class="string">'ul'</span>, &#123;<span class="attr">id</span>: ‘list’,<span class="attr">class</span>:’list<span class="string">'&#125;, [</span></span><br><span class="line"><span class="string">  el('</span>li<span class="string">', &#123;class: '</span>item<span class="string">'&#125;, ['</span>Item <span class="number">1</span><span class="string">']),</span></span><br><span class="line"><span class="string">  el('</span>li<span class="string">', &#123;class: '</span>item<span class="string">'&#125;, ['</span>Item <span class="number">2</span><span class="string">']),</span></span><br><span class="line"><span class="string">  el('</span>li<span class="string">', &#123;class: '</span>item<span class="string">'&#125;, ['</span>Item <span class="number">3</span><span class="string">'])</span></span><br><span class="line"><span class="string">],'</span>key<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default class Element &#123;</span></span><br><span class="line"><span class="string">   /**</span></span><br><span class="line"><span class="string">   * @param &#123;String&#125; tag '</span>div<span class="string">'</span></span><br><span class="line"><span class="string">   * @param &#123;Object&#125; props &#123; class: '</span>item<span class="string">' &#125;</span></span><br><span class="line"><span class="string">   * @param &#123;Array&#125; children [ Element1, '</span>text<span class="string">']</span></span><br><span class="line"><span class="string">   * @param &#123;String&#125; key option</span></span><br><span class="line"><span class="string">   */</span></span><br><span class="line"><span class="string">    constructor(tag, props, children, key)&#123; </span></span><br><span class="line"><span class="string">        this.tag = tag</span></span><br><span class="line"><span class="string">        this.props = props</span></span><br><span class="line"><span class="string">        if(Array.isArray(children))&#123; </span></span><br><span class="line"><span class="string">            this.children = children</span></span><br><span class="line"><span class="string">        &#125;else if(isString(children))&#123; </span></span><br><span class="line"><span class="string">            this.key = children</span></span><br><span class="line"><span class="string">            this.children = null</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        if(key) this.key = key</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    render()&#123; </span></span><br><span class="line"><span class="string">        let root = this._createElement( </span></span><br><span class="line"><span class="string">            this.tag,</span></span><br><span class="line"><span class="string">            this.props,</span></span><br><span class="line"><span class="string">            this.children,</span></span><br><span class="line"><span class="string">            this.key</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">        document.body.appendChild(root)</span></span><br><span class="line"><span class="string">        return root</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    create()&#123; </span></span><br><span class="line"><span class="string">        return this._createElement(this.tag,this.props,this.children,this.key)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    //创建节点  </span></span><br><span class="line"><span class="string">     //实现逻辑： </span></span><br><span class="line"><span class="string">        1 创建一个el空节点，遍历props,添加为el属性，如果存在key属性，添加key属性到le上</span></span><br><span class="line"><span class="string">        2 判断child参数是否存在，迭代child，判断child的每项是虚拟El节点则递归创建节点方法，不是El节点肯定为Text节点，</span></span><br><span class="line"><span class="string">          创建Text文本节点。 最后统一插入到el空节点下， 递归完成返回el节点</span></span><br><span class="line"><span class="string">    _createElement(tag,props,child,key)&#123; </span></span><br><span class="line"><span class="string">        let el = document.createElement(el);</span></span><br><span class="line"><span class="string">        for(let key in props)&#123; </span></span><br><span class="line"><span class="string">            value = props[key];   </span></span><br><span class="line"><span class="string">            el.setAttribute(key,value)</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        if(key)&#123; </span></span><br><span class="line"><span class="string">            el.setAttribute(‘key’,key)</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        if(child)&#123; </span></span><br><span class="line"><span class="string">            child.foreach(elem=&gt;&#123; </span></span><br><span class="line"><span class="string">                if(elem instanceOf Element)&#123; </span></span><br><span class="line"><span class="string">                    let els = _createElement(elem.tag,elem.props,elem.child,elem.key)</span></span><br><span class="line"><span class="string">                &#125;else&#123; </span></span><br><span class="line"><span class="string">                    let els = document.createTextNode(textNode)</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                el.appendChild(els)</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        return el;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Vue-router路由原理"><a href="#Vue-router路由原理" class="headerlink" title="Vue-router路由原理"></a>Vue-router路由原理</h2><p>目前在浏览器环境中这一功能的实现主要有两种方式：</p>
<h3 id="利用URL中的hash（“-”）-HashHistory"><a href="#利用URL中的hash（“-”）-HashHistory" class="headerlink" title="利用URL中的hash（“#”） HashHistory"></a>利用URL中的hash（“#”） HashHistory</h3><p>特点：   </p>
<ul>
<li>hash虽然出现在URL中，但不会被包括在HTTP请求中。它是用来指导浏览器动作的，对服务器端完全无用，因此，改变hash不会重新加载页面</li>
<li>可以为hash的改变添加监听事件： window.addEventListener(“hashchange”, funcRef, false)</li>
<li>每一次改变hash（window.location.hash），都会在浏览器的访问历史中增加一个记录</li>
</ul>
<p>HashHistory中的push()方法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">push (location: RawLocation, onComplete?: <span class="built_in">Function</span>, onAbort?: <span class="built_in">Function</span>) &#123;</span><br><span class="line">  <span class="keyword">this</span>.transitionTo(location, route =&gt; &#123;</span><br><span class="line">    pushHash(route.fullPath)</span><br><span class="line">    onComplete &amp;&amp; onComplete(route)</span><br><span class="line">  &#125;, onAbort)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pushHash</span> (<span class="params">path</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">window</span>.location.hash = path</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>transitionTo()方法是父类中定义的是用来处理路由变化中的基础逻辑的，push()方法最主要的是对window的hash进行了直接赋值HashHistory.replace()</p>
<pre><code>* replace()方法与push()方法不同之处在于，它并不是将新路由添加到浏览器访问历史的栈顶，而是替换掉当前的路由：
</code></pre><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">replace (location: RawLocation, onComplete?: <span class="built_in">Function</span>, onAbort?: <span class="built_in">Function</span>) &#123;</span><br><span class="line">  <span class="keyword">this</span>.transitionTo(location, route =&gt; &#123;</span><br><span class="line">    replaceHash(route.fullPath)</span><br><span class="line">    onComplete &amp;&amp; onComplete(route)</span><br><span class="line">  &#125;, onAbort)</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replaceHash</span> (<span class="params">path</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> i = <span class="built_in">window</span>.location.href.indexOf(<span class="string">'#'</span>)</span><br><span class="line">  <span class="built_in">window</span>.location.replace(</span><br><span class="line">    <span class="built_in">window</span>.location.href.slice(<span class="number">0</span>, i &gt;= <span class="number">0</span> ? i : <span class="number">0</span>) + <span class="string">'#'</span> + path</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="利用History-interface在-HTML5中新增的方法-HTML5History"><a href="#利用History-interface在-HTML5中新增的方法-HTML5History" class="headerlink" title="利用History interface在 HTML5中新增的方法 HTML5History"></a>利用History interface在 HTML5中新增的方法 HTML5History</h3><p>pushState(), replaceState()使得我们可以对浏览器历史记录栈进行修改：</p>
<p>两者优劣</p>
<p>调用history.pushState()相比于直接修改hash主要有以下优势：</p>
<ul>
<li>pushState设置的新URL可以是与当前URL同源的任意URL；而hash只可修改#后面的部分，故只可设置与当前同文档的URL</li>
<li>pushState设置的新URL可以与当前URL一模一样，这样也会把记录添加到栈中；而hash设置的新值必须与原来不一样才会触发记录添加到栈中</li>
<li>pushState通过stateObject可以添加任意类型的数据到记录中；而hash只可添加短字符串</li>
<li>pushState可额外设置title属性供后续使用</li>
</ul>
<p>history模式的一个问题</p>
<p>比如用户直接在地址栏中输入并回车，浏览器重启重新加载应用等。<br>hash模式仅改变hash部分的内容，而hash部分是不会包含在HTTP请求中的：</p>
<p><code>http://oursite.com/#/user/id   // 如重新请求只会发送http://oursite.com/</code></p>
<p>故在hash模式下遇到根据URL请求页面的情况不会有问题。而history模式则会将URL修改得就和正常请求后端的URL一样</p>
<p><code>http://oursite.com/user/id</code></p>
<p>解决：<br>在 Vue 应用里面覆盖所有的路由情况，然后在给出一个 404 页面。或者，如果是用 Node.js 作后台，可以使用服务端的路由来匹配 URL，当没有匹配到路由的时候返回 404，从而实现 fallback。<br>react使用一个叫做connect-history-api-fallback 中间件解决</p>
<h2 id="小程序的实现原理是什么？"><a href="#小程序的实现原理是什么？" class="headerlink" title="小程序的实现原理是什么？"></a>小程序的实现原理是什么？</h2><p>小程序架构 <a href="http://www.bubuko.com/infodetail-1906089.html" target="_blank" rel="noopener">http://www.bubuko.com/infodetail-1906089.html</a><br><img src="/images/yl1.png"></p>
<h2 id="generator-原理"><a href="#generator-原理" class="headerlink" title="generator 原理"></a>generator 原理</h2><p>Generator 是 ES6中新增的语法，和 Promise 一样，都可以用来异步编程</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 * 表示这是一个 Generator 函数</span></span><br><span class="line"><span class="comment">// 内部可以通过 yield 暂停代码</span></span><br><span class="line"><span class="comment">// 通过调用 next 恢复执行</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">1</span> + <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> b = test();</span><br><span class="line"><span class="built_in">console</span>.log(b.next()); <span class="comment">// &gt;  &#123; value: 2, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(b.next()); <span class="comment">// &gt;  &#123; value: 3, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(b.next()); <span class="comment">// &gt;  &#123; value: undefined, done: true &#125;</span></span><br><span class="line">从以上代码可以发现，加上 *的函数执行后拥有了 next 函数，也就是说函数执行后返回了一个对象。每次调用 next 函数可以继续执行被暂停的代码。以下是 Generator 函数的简单实现</span><br><span class="line"><span class="comment">// cb 也就是编译过的 test 函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generator</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> object = &#123;</span><br><span class="line">      next: <span class="number">0</span>,</span><br><span class="line">      stop: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      next: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> ret = cb(object);</span><br><span class="line">        <span class="keyword">if</span> (ret === <span class="literal">undefined</span>) <span class="keyword">return</span> &#123; <span class="attr">value</span>: <span class="literal">undefined</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          value: ret,</span><br><span class="line">          done: <span class="literal">false</span></span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;)();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 如果你使用 babel 编译后可以发现 test 函数变成了这样</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a;</span><br><span class="line">  <span class="keyword">return</span> generator(<span class="function"><span class="keyword">function</span>(<span class="params">_context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">switch</span> ((_context.prev = _context.next)) &#123;</span><br><span class="line">        <span class="comment">// 可以发现通过 yield 将代码分割成几块</span></span><br><span class="line">        <span class="comment">// 每次执行 next 函数就执行一块代码</span></span><br><span class="line">        <span class="comment">// 并且表明下次需要执行哪块代码</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">          a = <span class="number">1</span> + <span class="number">2</span>;</span><br><span class="line">          _context.next = <span class="number">4</span>;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">          _context.next = <span class="number">6</span>;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">                <span class="comment">// 执行完毕</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"end"</span>:</span><br><span class="line">          <span class="keyword">return</span> _context.stop();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/02/fe-engineering/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="卡牌大叔">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卡牌大叔的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/02/fe-engineering/" class="post-title-link" itemprop="url">前端工程化包含哪些内容？</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-02 23:30:52" itemprop="dateCreated datePublished" datetime="2019-04-02T23:30:52+08:00">2019-04-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-06-02 23:40:25" itemprop="dateModified" datetime="2019-06-02T23:40:25+08:00">2019-06-02</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前端工程化的衡量标准？"><a href="#前端工程化的衡量标准？" class="headerlink" title="前端工程化的衡量标准？"></a>前端工程化的衡量标准？</h2><ol>
<li>从开发角度衡量工程化主要体现在“快”。</li>
<li>从测试角度衡量工程化主要体现在“快”和“准”。 </li>
<li>从部署角度衡量工程化主要体现在“稳”。</li>
</ol>
<h2 id="开发层面-的构建问题"><a href="#开发层面-的构建问题" class="headerlink" title="开发层面 的构建问题"></a>开发层面 的构建问题</h2><ol>
<li>ES规范与浏览器兼容性不一致[ES规范的转译] </li>
<li>css 的弱编程能力[css预编译器支持,PostCSS 处理 hack后缀]</li>
<li>资源定位。</li>
<li>图片压缩/base64 内嵌/CSS Sprites[自动创建 CSS Sprites 图 ]</li>
<li>模块化组件化开发，</li>
<li>模块依赖分析和压缩打包[ JavaScript 模块化规范支持]。</li>
<li>增量更新于缓存</li>
<li>开发环境、测试环境和生产环境 区分</li>
</ol>
<p>解决：脚手架制作(Yeoman.js,commander.js)，对webpack进行二次封装( Fis，easywebpack) ，<br>整合一些webpack的一些插件和loader</p>
<h2 id="协作层面"><a href="#协作层面" class="headerlink" title="协作层面"></a>协作层面</h2><p>JavaScript部分逻辑依赖接口 API。<br>解决：webpack-dev-middleware ，动态构建，热更新HMR，Mock服务</p>
<h2 id="部署层面"><a href="#部署层面" class="headerlink" title="部署层面"></a>部署层面</h2><p>部分资源需要借助后端工程师部署。<br>解决：</p>
<ul>
<li>搭建本地工作流，测试沙箱，</li>
<li>云平台工作流，gitlab，gitflow，WebHook </li>
<li>继续集成持续交付(宙斯盾) 分支实现自动构建和测试。持续交付在持续集成的基础上 ，将集成并自动构建、测试通过的代码<br>自动部署至测试或者仿真生产环境中 ，而生产环境的部署仍须人工操作</li>
</ul>
<h2 id="前端开发人员培养"><a href="#前端开发人员培养" class="headerlink" title="前端开发人员培养"></a>前端开发人员培养</h2><p>基础素质<br><img src="/images/fe1.png"><br>方向 node方向，多终端方向(web/手机)， 可视化方向，</p>
<p>不论角色如何转变，前端工程师始终需要坚持如下两项原则。 </p>
<p><em>于产品而言，须保证性能和体验。
</em>于开发而言，须保证快速与严谨。</p>
<h2 id="本地工作流"><a href="#本地工作流" class="headerlink" title="本地工作流"></a>本地工作流</h2><p><img src="/images/fe2.png"></p>
<h2 id="HMR工作流程"><a href="#HMR工作流程" class="headerlink" title="HMR工作流程"></a>HMR工作流程</h2><p><img src="/images/fe3.png"></p>
<p>1&gt; 修改源文件并保存后， webpack 监听到 Filesystem Event 事件并触发了重新构建行为<br>2&gt; 构建完成之后， webpack将模块变动信息传递给 HMR Server。<br>3&gt; HMRServer通过WebSocket发送Push信息告知HMRRuntime需要更新客 户端模块 ， HMRRuntime 随后通过 HTTP 获取待更新模块的内容详情。<br>4&gt; 最终， HMRRuntime 将更新的模块进行替换，在此过程中浏览器不会进行刷新。</p>
<p>HMR Sever 以何种形式的文件将信息传递给 Runtime, Runtime 又是如何替换模块内容井 且立即生效等 。 其中涉及 webpack 内 部细节以及浏览器原理的部分知识</p>
<h2 id="缓存策略"><a href="#缓存策略" class="headerlink" title="缓存策略"></a>缓存策略</h2><ul>
<li>强制缓存<br>Cach-control: no-cache/max-age=31536000(1年)<br>expires = Sat, 14 Mar 2020 07:55:24 GMT </li>
</ul>
<p>协商缓存<br>request if-none-match:&lt;Etag值&gt;  response:Etag, </p>
<p><img src="/images/fe4.png"></p>
<p>覆盖更新与增量更新都是建立在启用浏览器强制缓存策略的前提下的。<br>增量更新是目前被业界广泛使用的前端静态资源更新策略，普遍的实现方案是通过为文件名添加 hash指纹。<br>覆盖更新的缺陷较多且没有较好的解决方案</p>
<ul>
<li>覆盖更新：<br>hash 指纹:通过既 定的数据摘要算法(目前使用 较广泛的是 md5)计算出文件的 hash值<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">”</span> <span class="attr">stylesheet</span>” <span class="attr">href</span>=<span class="string">”main</span> <span class="attr">.home</span> <span class="attr">.css</span>?<span class="attr">v</span>=<span class="string">858d5483”</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>问题：第一，必须保证 html 文件与改动的静态文件同步更新，否则会出现资源不同步 的情况 。第二，不利于版本回滚。</p>
<ul>
<li>增量更新：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">”</span> <span class="attr">stylesheet</span>” <span class="attr">href</span>=<span class="string">”main.home.858d543.css”</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">”text/javascript”</span> <span class="attr">src</span>=<span class="string">"main.home .bbcdaf73 . js"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>可以将静态资源先于动态 HTML 部署， 此时静态资源没有引用入口，不会对线上环境产生影响</p>
<h2 id="模块和组件的区别"><a href="#模块和组件的区别" class="headerlink" title="模块和组件的区别"></a>模块和组件的区别</h2><p>模块是一个白盒，侧重的是对属性的封装， 重心在设计和开发阶段， 不关注运行时逻辑，组件是一个黑盒，内部的逻辑是不可见的 。<br>组件是一个可以独立部署的软件单元，面向的是运行时，侧重于产品的功能性。 模块可以理解为零件。</p>
<p>如轮胎上的螺丝钉，而组件则是轮胎，组件是具备某项完整功能的一个整体 。 具体到前端领域， 一个 button是一个模块， 一个包括多个button的导航栏是一个组件。</p>
<p>模块化开发的价值</p>
<ol>
<li>避免命名冲突。 </li>
<li>便于依赖管理。</li>
<li>利于性能优化。<br> 其一，虽然不使用模块化规范开发也可以 实现按需加载，但是配合模块化规范的依赖管理功能可以让按需加载的模块更加易 于管理.<br> 其二，使用模块化构建工具将同步的散列模块进行合并打包， 减少了客户端的 HTTP 请求数量，不仅提高了 Web 应用的解析速度，而且减小了服 务器的并发压力;<br> 其三 ，细粒度的模块划分搭配动态加载令 Web 应用程序的解析更顺畅</li>
<li><p>提高可维护性。 </p>
</li>
<li><p>利于代码复用。</p>
</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/02/react-native/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="卡牌大叔">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卡牌大叔的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/02/react-native/" class="post-title-link" itemprop="url">react-native笔记</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-02 22:57:22" itemprop="dateCreated datePublished" datetime="2019-03-02T22:57:22+08:00">2019-03-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-06-02 23:21:52" itemprop="dateModified" datetime="2019-06-02T23:21:52+08:00">2019-06-02</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="对ReactNative评价"><a href="#对ReactNative评价" class="headerlink" title="对ReactNative评价"></a>对ReactNative评价</h2><ul>
<li><p>跨平台：目前React Native官方已经支持iOS、Android两个平台的移动设备，民间也有一些大牛在做macOS、tvOS，甚至UWP平台的适配。但由于不同平台特性不同，并不能一份代码在所有平台上直接运行，React Native的思想是「Learn once, write anywhere」，我们需要针对不同平台的特性写出不同的代码，尽量保持组件的高可复用性。</p>
</li>
<li><p>性能：官方宣称性能堪比Native，实际使用中我们会发现几个问题，比如复杂视图渲染出View层级过多、ListView（等同于iOS上的UITableView）无重用机制、有些组件存在内存泄露。这就会导致在部分低端Android机型上的性能过差，复杂的、大型的应用会有明显性能问题。</p>
</li>
<li><p>热更新：由于App Store应用商店发版迭代效率问题，热更新成为了iOS平台非常渴求的功能，可喜的是React Native的热更新能力非常好，通过将JavaScript代码部署到服务器中，运行过程中即可重新reload整个界面。</p>
</li>
<li><p>学习成本：对于iOS开发者来讲，要了解相当数量的Web前端开发知识才可以进行开发，对于Web前端开发者来讲，对于原生性能调优则需要原生开发知识和经验，所以说学习成本略高。</p>
</li>
<li><p>开发效率：Android和iOS平台可复用很多组件，仅部分代码需要各自平台分别维护，所以比开发两个平台原生应用效率要高得多。加上本身可动态渲染的能力，不用重新编译，Command⌘+R即可重新渲染界面，开发效率更是惊人地快。</p>
</li>
</ul>
<h2 id="React-Native-几大导航类型"><a href="#React-Native-几大导航类型" class="headerlink" title="React-Native 几大导航类型"></a>React-Native 几大导航类型</h2><ul>
<li>createStackNavigator 提供APP屏幕之间切换的能力，它是以栈的形式还管理屏幕之间的切换，新切换到的屏幕会放在栈的顶部。<br>组件中可以使 navigation.navigate(’routerModuleName’, {param} )   来切换转场</li>
</ul>
<ul>
<li><p>createDrawerNavigator 侧边导航抽屉路由</p>
<p>navigation.openDrawer( )  打开侧边栏<br>navigation.toggleDrawer( )  切换侧边栏<br>navigation.closeDrawer( ) 关闭侧边栏</p>
</li>
<li><p>createMaterialTopTabNavigator  顶部导航</p>
</li>
<li><p>createBottomTabNavigator 底部导航</p>
</li>
</ul>
<h2 id="如何开发一个换肤的功能？"><a href="#如何开发一个换肤的功能？" class="headerlink" title="如何开发一个换肤的功能？"></a>如何开发一个换肤的功能？</h2><p>1 开发ThemeFactory 包含主题列表，主题样式<br>2 开发一个Dao，用来持久化应用的主题，包含存，取数据，浏览器可以存储在locationStorage里，react-native存储在AsyncStorage里。<br>3 开发换肤组件html+css，组件选取盘，比如颜色名称，<br>4 开发action，配置action类型，THEME_CHANGE(主题更改)，THEME_INIT(主题初始化)， SHOW_THEME_VIEW(皮肤组件显示)， 以及相对应的reducer.<br>5 用户前端点击换肤组件，触发选取组件事件，在事件里拿到主题的key,  调用Dao保存当前选取主题，解决用户离开应用再返回时候拿到配置<br>触发sTHEME_CHANGE action，reducer，把颜色key 保存到state里，用来做应用适时替换。<br>这样就完成了换肤功能。</p>
<h2 id="redux-EventBut-DeviceEventEmitter不同点"><a href="#redux-EventBut-DeviceEventEmitter不同点" class="headerlink" title="redux/EventBut/DeviceEventEmitter不同点"></a>redux/EventBut/DeviceEventEmitter不同点</h2><p>redux  用来处理整个应用的共享数据，持久化数据，页面动作相关的数据</p>
<p>EventBus 可以用来处理多个页面之间的 简单的状态传递，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">EventBus.getInstance().addListener(EventTypes.favoriteChanged_trending, <span class="keyword">this</span>.favoriteChangeListener = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.isFavoriteChanged = <span class="literal">true</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">EventBus.getInstance().addListener(EventTypes.bottom_tab_select, <span class="keyword">this</span>.bottomTabSelectListener = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (data.to === <span class="number">1</span> &amp;&amp; <span class="keyword">this</span>.isFavoriteChanged) &#123;</span><br><span class="line">        <span class="keyword">this</span>.loadData(<span class="literal">null</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.storeName === FLAG_STORAGE.flag_popular) &#123;</span><br><span class="line">    EventBus.getInstance().fireEvent(EventTypes.favorite_changed_popular);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    EventBus.getInstance().fireEvent(EventTypes.favoriteChanged_trending);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DeviceEventEmitter 用来解决单页面 组件之间的状态处理<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.timeSpanChangeListener = DeviceEventEmitter.addListener(EVENT_TYPE_TIME_SPAN_CHANGE, (timeSpan) =&gt; &#123;</span><br><span class="line">    <span class="keyword">this</span>.timeSpan = timeSpan;</span><br><span class="line">    <span class="keyword">this</span>.loadData();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">DeviceEventEmitter.emit(EVENT_TYPE_TIME_SPAN_CHANGE, tab);</span><br></pre></td></tr></table></figure></p>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p>action<br><img src="/images/rn7.png">          </p>
<p>reducer<br><img src="/images/rn8.png">   </p>
<p>dispatch 一个action之后，进入reducer，处理完成之后统一返回给state</p>
<p>作为this.props的属性 返回给 this.props</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function"><span class="params">state</span> =&gt;</span> (&#123;</span><br><span class="line">    popular: state.popular</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function"><span class="params">dispatch</span> =&gt;</span>(&#123;</span><br><span class="line">    onLoadPopularData: <span class="function">(<span class="params">storeName, url</span>) =&gt;</span> dispatch(actions.onLoadPopularData(storeName,url))</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PopularTabPage = connect(mapStateToProps, mapDispatchToProps)(PopularTab)</span><br></pre></td></tr></table></figure>
<p>这里的state.popular实际为 combineReducers里配置的popular名称以及总返回值。<br><img src="/images/rn9.png"> </p>
<p><img src="/images/rn10.png"> </p>
<p>AsyncStorage取代localStorage<br>import {AsyncStorage} from ‘react-native’</p>
<h2 id="fetch取代-httpajaxrequest请求"><a href="#fetch取代-httpajaxrequest请求" class="headerlink" title="fetch取代 httpajaxrequest请求"></a>fetch取代 httpajaxrequest请求</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url = <span class="string">`https://api.github.com/search/repositories?q=<span class="subst">$&#123;<span class="keyword">this</span>.searchKey&#125;</span>`</span>;</span><br><span class="line"><span class="built_in">console</span>.log(url);</span><br><span class="line">fetch(url)</span><br><span class="line">    .then(<span class="function"><span class="params">response</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> response.text() <span class="comment">//格式为为text</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="params">responseText</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            showText:responseText</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">e</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            showText:e.toString()</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>SafeAreaView  针对iPhone X设备齐刘海页面适配的组件<br>友盟  U-DPlus 互联网运营数据服务需要申请注册才能使用。集成ReactNative也是巨坑无比</p>
<p>====</p>
<h2 id="react-native-debug模式加载100-之后空白页"><a href="#react-native-debug模式加载100-之后空白页" class="headerlink" title="react native debug模式加载100%之后空白页"></a>react native debug模式加载100%之后空白页</h2><ul>
<li>“GET /debuggerWorker.js HTTP/1.1” 404 156 “<a href="http://localhost:8081/debugger-ui“" target="_blank" rel="noopener">http://localhost:8081/debugger-ui“</a></li>
<li>Downloading JavaScript bundle 100%</li>
</ul>
<ol>
<li>“GET /debuggerWorker.js HTTP/1.1”的问题是由于我chrome的问题无法自动打开<a href="http://localhost:8081/debugger-ui的页面导致的。" target="_blank" rel="noopener">http://localhost:8081/debugger-ui的页面导致的。</a></li>
<li>Downloading JavaScript bundle 100%加载之后一直空白页尝试了多次一直都这样。</li>
</ol>
<p>最后我通过使用官方的react native debugger工具成功debug了</p>
<h2 id="禁用黄色调试信息"><a href="#禁用黄色调试信息" class="headerlink" title="禁用黄色调试信息"></a>禁用黄色调试信息</h2><p>constructor(props){<br>    super(props);<br>    console.disableYellowBox = true;<br>}</p>
<h2 id="reduxifyNavigator-已经废弃"><a href="#reduxifyNavigator-已经废弃" class="headerlink" title="reduxifyNavigator 已经废弃"></a>reduxifyNavigator 已经废弃</h2><p><img src="/images/rn5.png"><br><img src="/images/rn6.png"></p>
<h2 id="Failed-to-build-iOS-project"><a href="#Failed-to-build-iOS-project" class="headerlink" title="Failed to build iOS project"></a>Failed to build iOS project</h2><p>info<br>error Failed to build iOS project. We ran “xcodebuild” command but it exited with error code 65. To debug build logs further, consider building your app with Xcode.app, by opening Github_RN_test.xcodeproj<br><strong> BUILD FAILED </strong></p>
<p>原因：xcode编译未通过，说明ios 有问题，可以打开ios项目在xcode里build一下查看具体出错原因。<br>一般出现的是模块安装，删除过程中，react-native link过后的模块 出错，没有删除或者未添加。<br><img src="/images/rn4.png"></p>
<h2 id="react-native-vector-icons-出错"><a href="#react-native-vector-icons-出错" class="headerlink" title="react-native-vector-icons 出错"></a>react-native-vector-icons 出错</h2><p><img src="/images/rn3.png"><br>reason: react-native-vector-icons 安装后没有执行link 简单执行react-native link 并不能自动执行所有模块的link操作。<br>react-native link react-native-vector-icons</p>
<h2 id="Navigator-没有用createAppContainer-出错"><a href="#Navigator-没有用createAppContainer-出错" class="headerlink" title="Navigator 没有用createAppContainer 出错"></a>Navigator 没有用createAppContainer 出错</h2><p><img src="/images/rn2.png"></p>
<h2 id="没有-react-native-link"><a href="#没有-react-native-link" class="headerlink" title="没有 react-native link"></a>没有 react-native link</h2><p>react-native 模块安装后没有 react-native link<br><img src="/images/rn1.png"></p>
<h2 id="不能多重项目嵌套运行"><a href="#不能多重项目嵌套运行" class="headerlink" title="不能多重项目嵌套运行"></a>不能多重项目嵌套运行</h2><p>error: No bundle URL present Make sure you’re running a packager server or have included a .jsbundle file</p>
<ul>
<li>多半是一个项目嵌套多个项目，多个package.json </li>
<li>本地开了翻墙工具</li>
</ul>
<p>-Go back to the old version of React Native</p>
<ul>
<li>Run “npm install -g react-native-git-upgrade”</li>
<li>Run “react-native-git-upgrade”</li>
</ul>
<h2 id="Loading-dependency-graph-done-死住"><a href="#Loading-dependency-graph-done-死住" class="headerlink" title="Loading dependency graph, done. 死住"></a>Loading dependency graph, done. 死住</h2><ul>
<li>查看端口8081是否被占用</li>
<li>在浏览器中输入<a href="http://localhost:8081/index.ios.bundle，查看是否有bundling的提示" target="_blank" rel="noopener">http://localhost:8081/index.ios.bundle，查看是否有bundling的提示</a></li>
<li>删除手机/模拟器上的App,重新执行run-ios</li>
<li>下载react第三方库 <a href="https://github.com/facebook/react-native/tree/0.57-stable/scripts" target="_blank" rel="noopener">https://github.com/facebook/react-native/tree/0.57-stable/scripts</a></li>
<li>正常情况下，react-native run-ios打包完成，在模拟器上会马上安装demo APP，然后加载 Loading dependency graph, done，哪个部位出错就解决哪个部位。</li>
</ul>
<p>解决react-native 8081端口占用问题<br>lsof -i:8081<br>kill pid pid</p>
<h2 id="开发目录权限问题"><a href="#开发目录权限问题" class="headerlink" title="开发目录权限问题"></a>开发目录权限问题</h2><p>gitclone下来的项目 react-native run-ios 会出现Metro Bundle EACCES: permission denied</p>
<ol>
<li>cd 你的文件夹路径的上一级目录。</li>
<li>sudo chmod -R 777 你的文件夹名。</li>
<li>输入密码。<br>4.成功<br><a href="https://www.jianshu.com/p/ea5635dbfc23" target="_blank" rel="noopener">link</a></li>
</ol>
<h2 id="boost-1-63-0-tar-gz等错误"><a href="#boost-1-63-0-tar-gz等错误" class="headerlink" title="boost_1_63_0.tar.gz等错误"></a>boost_1_63_0.tar.gz等错误</h2><p>【RN踩坑】React-native 0.45版本以上出现 boost_1_63_0.tar.gz等错误</p>
<p><a href="https://blog.csdn.net/baiyu753159/article/details/76945236" target="_blank" rel="noopener">link</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/20/nodejs/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="卡牌大叔">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卡牌大叔的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/20/nodejs/" class="post-title-link" itemprop="url">nodejs中间件笔记</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-20 19:03:15" itemprop="dateCreated datePublished" datetime="2019-02-20T19:03:15+08:00">2019-02-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-06-02 22:25:23" itemprop="dateModified" datetime="2019-06-02T22:25:23+08:00">2019-06-02</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>=====</p>
<h2 id="gm-图片处理工具"><a href="#gm-图片处理工具" class="headerlink" title="gm 图片处理工具"></a>gm 图片处理工具</h2><p><a href="https://blog.csdn.net/dreamer2020/article/details/51647885" target="_blank" rel="noopener">link</a><br>先读取(gm)图片后，可以先进行拼接(mosaic, compose, append)，然后裁剪(crop)，放缩(resize)到指定大小后，最后才保存(write)下来</p>
<h2 id="formidable-模块"><a href="#formidable-模块" class="headerlink" title="formidable 模块"></a>formidable 模块</h2><p>是一个用于处理文件、图片、视频等数据上传的模块，支持GB级上传数据处理，支持多种客户端数据提交。有极高的测试覆盖率，非常适合在生产环境中使用。<br><a href="https://blog.csdn.net/qfire/article/details/79398815" target="_blank" rel="noopener">link</a></p>
<h2 id="connect-history-api-fallback"><a href="#connect-history-api-fallback" class="headerlink" title="connect-history-api-fallback"></a>connect-history-api-fallback</h2><p>解决react前端直接在浏览器输入地址访问报404错误的问题 <a href="https://blog.csdn.net/astonishqft/article/details/82762354" target="_blank" rel="noopener">link</a></p>
<h2 id="express-winston-winston-日志"><a href="#express-winston-winston-日志" class="headerlink" title="express-winston winston 日志"></a>express-winston winston 日志</h2><p>Node.js最流行的日志框架之一，设计为一个简单通用的日志库，</p>
<h2 id="express-session"><a href="#express-session" class="headerlink" title="express-session"></a>express-session</h2><p>session/cookie对比  <a href="https://www.jianshu.com/p/5a0ccd1ee27e" target="_blank" rel="noopener">link</a><br>中间件将会话数据存储在服务器上；它仅将会话标识（而非会话数据）保存在 cookie 中。<br>从1.5.0版本开始, express-session不再依赖cookie-parser,直接通过req/res读取/写入;默认存储位置内存存储(服务器端),</p>
<h2 id="cookieParser-签名与解析"><a href="#cookieParser-签名与解析" class="headerlink" title="cookieParser 签名与解析"></a>cookieParser 签名与解析</h2><p>cookie设置与解析，cookie签名与解析，实现<br><a href="https://www.cnblogs.com/chyingp/p/express-cookie-parser-deep-in.html" target="_blank" rel="noopener">link</a></p>
<h2 id="config-lite-自动获取config"><a href="#config-lite-自动获取config" class="headerlink" title="config-lite 自动获取config"></a>config-lite 自动获取config</h2><p>自动获取config不同环境下配置文件使用 <a href="https://segmentfault.com/a/1190000010099383" target="_blank" rel="noopener">https://segmentfault.com/a/1190000010099383</a></p>
<h2 id="captchang-验证码"><a href="#captchang-验证码" class="headerlink" title="captchang 验证码"></a>captchang 验证码</h2><p>模块实现图片验证码 <a href="https://www.cnblogs.com/fangdong/p/6853124.html" target="_blank" rel="noopener">https://www.cnblogs.com/fangdong/p/6853124.html</a></p>
<h2 id="bluebird-异步promise"><a href="#bluebird-异步promise" class="headerlink" title="bluebird 异步promise"></a>bluebird 异步promise</h2><p>一种更为优雅的Promise异步使用方式，还有async await</p>
<h2 id="pm2-node进程管理工具"><a href="#pm2-node进程管理工具" class="headerlink" title="pm2 node进程管理工具"></a>pm2 node进程管理工具</h2><p><a href="https://juejin.im/post/5be406705188256dbb5176f9" target="_blank" rel="noopener">link</a><br><a href="https://www.cnblogs.com/zhoujie/p/nodejs4.html" target="_blank" rel="noopener">link</a></p>
<p>pm2 start   基本启动命令<br>pm2 show (appname|id)   查看详细状态信息<br>pm2 list  查看所有启动的进程列表<br>pm2 monit 监控每个 node 进程的 cpu 和内存使用情况<br>pm2 logs  显示所有进程的日志信息<br>pm2 web  监控运行这些进程的机器的状态<br>pm2 stop (id|all)   停止 指定/所有 进程<br>pm2 restart (id|all)  重启 指定/所有 进程<br>pm2 delete (id|all)  * 杀死 指定/所有 进程</p>
<p>pm2 start server.js -i (number|max)  负载均衡</p>
<p>npm install -g pm2-web  实现监控可视化  </p>
<h2 id="cross-env能跨平台地设置及使用环境变量"><a href="#cross-env能跨平台地设置及使用环境变量" class="headerlink" title="cross-env能跨平台地设置及使用环境变量"></a>cross-env能跨平台地设置及使用环境变量</h2><p>大多数情况下，在windows平台下使用类似于: NODE_ENV=production的命令行指令会卡住，windows平台与POSIX在使用命令行时有许多区别（例如在POSIX，使用$ENV_VAR,在windows，使用%ENV_VAR%。。。）<br>cross-env让这一切变得简单，不同平台使用唯一指令，无需担心跨平台问题</p>
<h2 id="nodemon-热更新工具"><a href="#nodemon-热更新工具" class="headerlink" title="nodemon 热更新工具"></a>nodemon 热更新工具</h2><p>解决问题：修改代码后，需要重新启动 Express 应用，所做的修改才能生效。若之后的每次代码修改都要重复这样的操作，势必会影响开发效率，本文将详细介绍Nodemon，它会监测项目中的所有文件，一旦发现文件有改动，Nodemon 会自动重启应用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"dev"</span>: <span class="string">"cross-env NODE_ENV=development nodemon --harmony index.js"</span>,</span><br><span class="line">  <span class="string">"check"</span>: <span class="string">"cross-env NODE_ENV=production nodemon --harmony index.js"</span>,</span><br><span class="line">  <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,</span><br><span class="line">  <span class="string">"deploy"</span>: <span class="string">"pm2 deploy production"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="connect-history-api-fallback-1"><a href="#connect-history-api-fallback-1" class="headerlink" title="connect-history-api-fallback"></a>connect-history-api-fallback</h2><p>单页面应用程序(SPA)通常使用一个web浏览器可以访问的索引文件，比如index.html，然后，在HTML5 History API的帮助下（react-router就是基于History API实现的），借助JavaScript处理应用程序中的导航。当用户单击刷新按钮或直接通过输入地址的方式访问页面时，会出现找不到页面的问题，因为这两种方式都绕开了History API，而我们的请求又找不到后端对应的路由，页面返回404错误。</p>
<p>connect-history-api-fallback中间件很好的解决了这个问题。具体来说，每当出现符合以下条件的请求时，它将把请求定位到你指定的索引文件(默认为/index.html)。<br><a href="https://www.jianshu.com/p/6f564064004e" target="_blank" rel="noopener">link</a></p>
<h2 id="express-session-connect-mongo"><a href="#express-session-connect-mongo" class="headerlink" title="express-session connect-mongo"></a>express-session connect-mongo</h2><p><a href="https://blog.csdn.net/cckevincyh/article/details/79816491" target="_blank" rel="noopener">Express Session的使用</a><br><a href="https://www.cnblogs.com/l8l8/p/9317069.html" target="_blank" rel="noopener">node exprss-session 和connect-mongo</a><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">let</span> session = <span class="built_in">require</span>(<span class="string">'express-session'</span>);</span><br><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> express();</span><br><span class="line"><span class="keyword">let</span> MongoStore = <span class="built_in">require</span>(<span class="string">'connect-mongo'</span>)(session);</span><br><span class="line">app.use(session(&#123;</span><br><span class="line">    secret:<span class="string">'keyboard cat'</span>, <span class="comment">//加密字符串也可以写数组</span></span><br><span class="line">    resave:<span class="literal">true</span>,     <span class="comment">//强制保存session 建议设置成false</span></span><br><span class="line">    saveUninitialized:<span class="literal">true</span>,  <span class="comment">//强制保存未初始化的内容</span></span><br><span class="line">    rolling:<span class="literal">true</span>, <span class="comment">//动态刷新页面cookie存放时间</span></span><br><span class="line">    cookie:&#123;<span class="attr">maxAge</span>:<span class="number">10000</span>&#125;, <span class="comment">//保存时效</span></span><br><span class="line">    store:<span class="keyword">new</span> MongoStore(&#123;   <span class="comment">//将session存进数据库  用来解决负载均衡的问题</span></span><br><span class="line">        url:<span class="string">'mongodb://127.0.0.1:27017/db06'</span>,</span><br><span class="line">        touchAfter:<span class="number">24</span>*<span class="number">3600</span> <span class="comment">//通过这样做，设置touchAfter:24 * 3600，您在24小时内</span></span><br><span class="line">       <span class="comment">//只更新一次会话，不管有多少请求(除了在会话数据上更改某些内容的除外)</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;))</span><br><span class="line">app.get(<span class="string">'/login'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    req.session.userinfo = <span class="string">'admin'</span>;</span><br><span class="line">    res.send(<span class="string">'存储成功'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="cookie-parser"><a href="#cookie-parser" class="headerlink" title="cookie-parser"></a>cookie-parser</h2><p><a href="https://www.cnblogs.com/chyingp/p/express-cookie-parser-deep-in.html" target="_blank" rel="noopener">Express使用进阶：cookie-parser中间件实现深入剖析</a><br><a href="https://www.jianshu.com/p/aa6cc22c8d23" target="_blank" rel="noopener">express中cookie的使用和cookie-parser的解读</a></p>
<h2 id="Express-function-req-res-next"><a href="#Express-function-req-res-next" class="headerlink" title="Express function(req,res,next)"></a>Express function(req,res,next)</h2><p>Node.js Express 里常常见到function(req, res, next)</p>
<p><strong>req :  request的缩写， 请求的数据Request</strong><br>对象表示 HTTP 请求，包含了请求查询字符串，参数，内容，HTTP 头部等属性。<br>常用req.body.xx来表示POST的xx属性</p>
<p><strong>res:   response的缩写， 响应的数据</strong><br>Response 对象表示 HTTP 响应，即在接收到请求时向客户端发送的 HTTP 响应数据。<br>我们常常用res.send() 传送HTTP响应 , res.render()渲染结果页面</p>
<p><strong>next 前往下一个中间件</strong><br>执行相同路径的下一个方法;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">route.get(&quot;/a&quot;,function(req,res,next)&#123;</span><br><span class="line">    console.log(&quot;a&quot;);</span><br><span class="line">    next();</span><br><span class="line">&#125;)</span><br><span class="line">route.get(&quot;/a&quot;,function(req,res)&#123;</span><br><span class="line">    console.log(&quot;b&quot;);</span><br><span class="line">    res.send(&quot;a&quot;);</span><br><span class="line">&#125;)</span><br><span class="line">//a,b</span><br></pre></td></tr></table></figure></p>
<h2 id="Mongoose"><a href="#Mongoose" class="headerlink" title="Mongoose"></a>Mongoose</h2><p><a href="https://segmentfault.com/a/1190000012095054" target="_blank" rel="noopener">link</a></p>
<h2 id="chalk"><a href="#chalk" class="headerlink" title="chalk"></a>chalk</h2><p>日志中间件</p>
<h2 id="config-lite"><a href="#config-lite" class="headerlink" title="config-lite"></a>config-lite</h2><p>config-lite 是一个轻量的读取配置文件的模块。<br>config-lite 会根据环境变量（NODE_ENV）的不同从当前执行进程目录下的 config 目录加载不同的配置文件。<br>config-lite 支持 .js、.json、.node、.yml、.yaml 后缀的文件。</p>
<p><strong>Example</strong></p>
<p><strong>config/default.js</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &apos;default&apos;;</span><br></pre></td></tr></table></figure>
<p><strong>config/test.js</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &apos;test&apos;;</span><br></pre></td></tr></table></figure>
<p><strong>config/production.js</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &apos;production&apos;;</span><br></pre></td></tr></table></figure>
<p>====================================</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node app</span><br><span class="line"></span><br><span class="line">require(&apos;config-lite&apos;); //=&gt; &apos;default&apos;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV=test node app</span><br><span class="line"></span><br><span class="line">require(&apos;config-lite&apos;); //=&gt; &apos;test&apos;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV=production node app</span><br><span class="line"></span><br><span class="line">require(&apos;config-lite&apos;); //=&gt; &apos;production&apos;</span><br></pre></td></tr></table></figure>
<p>or:</p>
<p><code>`</code><br>NODE_ENV=production node app –host=localhost –port=3000</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/03/trading-map/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="卡牌大叔">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卡牌大叔的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/03/trading-map/" class="post-title-link" itemprop="url">金融交易能力模型</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-12-03 15:17:14" itemprop="dateCreated datePublished" datetime="2018-12-03T15:17:14+08:00">2018-12-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-06-17 17:31:06" itemprop="dateModified" datetime="2019-06-17T17:31:06+08:00">2019-06-17</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="/images/trading-map.png"></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/02/webpackbabel/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="卡牌大叔">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卡牌大叔的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/02/webpackbabel/" class="post-title-link" itemprop="url">webpack/babel笔记</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-11-02 22:26:17" itemprop="dateCreated datePublished" datetime="2018-11-02T22:26:17+08:00">2018-11-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-06-02 23:22:08" itemprop="dateModified" datetime="2019-06-02T23:22:08+08:00">2019-06-02</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="babel-基础"><a href="#babel-基础" class="headerlink" title="babel 基础"></a>babel 基础</h2><p><a href="https://segmentfault.com/a/1190000011665642" target="_blank" rel="noopener">link</a></p>
<h2 id="babel-core"><a href="#babel-core" class="headerlink" title="babel-core"></a>babel-core</h2><p>是作为babel的核心存在,负责转义ast,<br>import {tranform, transformFile, transformFileSync, transformFromAst }  from ‘babel-core’</p>
<h2 id="babel-cli"><a href="#babel-cli" class="headerlink" title="babel-cli"></a>babel-cli</h2><p>babel-cli是一个通过命令行对js文件进行换码的工具。<br>babel script.js</p>
<h2 id="babel-node"><a href="#babel-node" class="headerlink" title="babel-node"></a>babel-node</h2><p>这是一个支持ES6的js执行环境。</p>
<h2 id="babel-register"><a href="#babel-register" class="headerlink" title="babel-register"></a>babel-register</h2><p>底层改写了node的require方法，引入babel-register之后所有require并以.es6, .es, .jsx 和 .js为后缀的模块都会经过babel的转译。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//test.js</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">'shenfq'</span>;</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> json = &#123;name&#125;;</span><br><span class="line">    <span class="keyword">return</span> json;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//main.js</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'babel-register'</span>);</span><br><span class="line"><span class="keyword">var</span> test = <span class="built_in">require</span>(<span class="string">'./test.js'</span>);  <span class="comment">//test.js中的es6语法将被转译成es5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(test.toString()); <span class="comment">//通过toString方法，看看控制台输出的函数是否被转译</span></span><br></pre></td></tr></table></figure>
<h3 id="babel-polyfill"><a href="#babel-polyfill" class="headerlink" title="babel-polyfill"></a>babel-polyfill</h3><p>polyfill在代码中的作用主要是用已经存在的语法和api实现一些浏览器还没有实现的api，对浏览器的一些缺陷做一些修补。例如Array新增了includes方法，箭头函数、解构赋值、class、Promise<br>.babelrc  babel run command缩写</p>
<p>官方唯一推荐preset：babel-preset-env。</p>
<h2 id="webpack-大致运行流程"><a href="#webpack-大致运行流程" class="headerlink" title="webpack 大致运行流程"></a>webpack 大致运行流程</h2><ol>
<li>获取配置参数 webpack.config.js </li>
<li>实例化Compiler, 通过run方法开启编译   //Compiler类，</li>
<li>根据入口文件, 创建依赖项, 并递归获取所有模块的依赖模块 //</li>
<li>通过loader去解析匹配到的模块  </li>
<li>获取模板, 把解析好的数据套进不同的模板 // 切割模块儿模板，</li>
<li>输出文件到指定路径 </li>
</ol>
<h2 id="如何编写一个Loader"><a href="#如何编写一个Loader" class="headerlink" title="如何编写一个Loader"></a>如何编写一个Loader</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stylus-loader</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stylus = <span class="built_in">require</span>(<span class="string">'stylus'</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span> (<span class="params">source</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> css = <span class="string">''</span></span><br><span class="line">    stylus.render(source, (err, data) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">            css = data</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(error)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> css</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = loader</span><br><span class="line"></span><br><span class="line"><span class="comment">// style-loader</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span> (<span class="params">source</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> script = <span class="string">`</span></span><br><span class="line"><span class="string">        let style = document.createElement('style')</span></span><br><span class="line"><span class="string">        style.innerHTML = <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(source)&#125;</span></span></span><br><span class="line"><span class="string">        document.body.appendChild(style)</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">    <span class="keyword">return</span> script</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = loader</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> root = path.join(__dirname, <span class="string">'./'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">    mode : <span class="string">'development'</span>,</span><br><span class="line">    entry : path.join(root, <span class="string">'src/app.js'</span>),</span><br><span class="line">    output : &#123;</span><br><span class="line">        path : path.join(root, <span class="string">'dist'</span>),</span><br><span class="line">        filename : <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span> : &#123;</span><br><span class="line">        rules : [</span><br><span class="line">            &#123;</span><br><span class="line">                test : <span class="regexp">/\.styl(us)?$/</span>,</span><br><span class="line">                use : [  <span class="comment">//root, loaders 路径名称</span></span><br><span class="line">                    path.join(root, <span class="string">'loaders'</span>, <span class="string">'style-loader.js'</span>),</span><br><span class="line">                    path.join(root, <span class="string">'loaders'</span>, <span class="string">'stylus-loader.js'</span>)</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = config</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> name = <span class="built_in">require</span>(<span class="string">'./js/moduleA.js'</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./style/init.styl'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> oH1 = <span class="built_in">document</span>.createElement(<span class="string">'h1'</span>)</span><br><span class="line">oH1.innerHTML = <span class="string">'Hello '</span> + name</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(oH1)</span><br></pre></td></tr></table></figure>
<h2 id="如何写一个webpack插件"><a href="#如何写一个webpack插件" class="headerlink" title="如何写一个webpack插件"></a>如何写一个webpack插件</h2><p>1、一个 js 命名函数。<br>2、在原型链上存在一个 apply 方法。<br>3、为该插件指定一个 Webpack 的事件钩子函数。<br>4、使用 Webpack 内部的实例对象（Compiler 或者 Compilation）具有的属性或者方法。<br>5、当功能完成以后，需要执行 Webpack 的回调函数。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myExampleWebpackPlugin</span>(<span class="params"> </span>)</span>&#123;  &#125;</span><br><span class="line">myExampleWebpackPlugin.prototype.apply = <span class="function"><span class="keyword">function</span>(<span class="params">Compiler</span>)</span>&#123; </span><br><span class="line">    Compiler.plugin(‘compilation’,<span class="function"><span class="keyword">function</span>(<span class="params">compilation,callback</span>)</span>&#123; </span><br><span class="line">        <span class="built_in">console</span>.log(‘<span class="keyword">this</span> is an example plugin’);</span><br><span class="line">        callback( ); </span><br><span class="line">     &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure></p>
<p>Compiler 对象： Compiler 对象代表了 Webpack 完整的可配置的环境。<br>该对象在 Webpack 启动的时候会被创建，同时该对象也会被传入一些可控的配置，如 Options、Loaders、Plugins。<br>当插件被实例化的时候，会收到一个 Compiler 对象，通过这个对象可以访问 Webpack 的内部环境。</p>
<p>Compilation 对象： Compilation 对象在每次文件变化的时候都会被创建，因此会重新产生新的打包资源。<br>该对象表示本次打包的模块、编译的资源、文件改变和监听的依赖文件的状态。</p>
<h2 id="如何手写一个简单的webpack"><a href="#如何手写一个简单的webpack" class="headerlink" title="如何手写一个简单的webpack"></a>如何手写一个简单的webpack</h2><p><a href="https://juejin.im/post/5ccfe03f51882541e37e6959" target="_blank" rel="noopener">link</a></p>
<h2 id="clean-webpack-plugin"><a href="#clean-webpack-plugin" class="headerlink" title="clean-webpack-plugin"></a>clean-webpack-plugin</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin’); 不必每一次都有手动清除dist,自动清除。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">purifycss-webpack   css优化去重去无效代码</span></span><br><span class="line"><span class="string">css打包优化去重去无效代码 https://blog.csdn.net/zhoulucky1993/article/details/85228990</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const PurifyCSS = require("purifycss-webpack");</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">new PurifyCSS(&#123;</span></span><br><span class="line"><span class="string">    paths: glob.sync([</span></span><br><span class="line"><span class="string">        // 要做CSS Tree Shaking的路径文件</span></span><br><span class="line"><span class="string">        path.join(__dirname, ".html"),</span></span><br><span class="line"><span class="string">        path.join(__dirname, "src/*.js")</span></span><br><span class="line"><span class="string">    ])</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure>
<h3 id="extract-text-webpack-plugin"><a href="#extract-text-webpack-plugin" class="headerlink" title="extract-text-webpack-plugin"></a>extract-text-webpack-plugin</h3><p>该插件的主要是为了抽离css样式,防止将样式打包在js中引起页面样式加载错乱的现象。</p>
<h2 id="glob-all-glob"><a href="#glob-all-glob" class="headerlink" title="glob-all , glob"></a>glob-all , glob</h2><p>在webpack中的使用。<br><a href="https://www.cnblogs.com/waitforyou/p/7044171.html" target="_blank" rel="noopener">link</a></p>
<p>读取某个文件夹下所有的文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">glob(<span class="string">"./src/components/**/*.js"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">er, files</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(files);</span><br><span class="line">    <span class="keyword">return</span> files</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// [ './src/components/index/index.js',</span></span><br><span class="line"><span class="comment">//     './src/components/news/n.js',</span></span><br><span class="line"><span class="comment">//     './src/components/news/news.js' ]</span></span><br></pre></td></tr></table></figure>
<h2 id="webpack3-webpack4升级"><a href="#webpack3-webpack4升级" class="headerlink" title="webpack3-webpack4升级"></a>webpack3-webpack4升级</h2><p>从webpack4开始官方移除了commonchunk插件，改用了optimization属性进行更加灵活的配置，这也应该是从V3升级到V4的代码修改过程中最为复杂的一部分，<br>下面的代码即是optimize.splitChunks 中的一些配置参考</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    runtimeChunk: &#123;</span><br><span class="line">      name: <span class="string">'manifest'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    minimizer: <span class="literal">true</span>, <span class="comment">// [new UglifyJsPlugin(&#123;...&#125;)]</span></span><br><span class="line">    splitChunks:&#123;</span><br><span class="line">      chunks: <span class="string">'async’, //表示哪些代码需要优化，有三个可选值：initial(初始块)、async(按需加载块)、all(全部块)，默认为async</span></span><br><span class="line"><span class="string">      minSize: 30000,  //表示在压缩前的最小模块大小，默认为30000</span></span><br><span class="line"><span class="string">      minChunks: 1,    //表示被引用次数，默认为1</span></span><br><span class="line"><span class="string">      maxAsyncRequests: 5, //按需加载时候最大的并行请求数，默认为5</span></span><br><span class="line"><span class="string">      maxInitialRequests: 3, //一个入口最大的并行请求数，默认为3</span></span><br><span class="line"><span class="string">       automaticNameDelimiter: ‘~’, //命名连接符</span></span><br><span class="line"><span class="string">      name: false, //拆分出来块的名字，默认由块名和hash值自动生成</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      cacheGroups: &#123;  //缓存组。缓存组的属性除上面所有属性外，还有test, priority, reuseExistingChunk</span></span><br><span class="line"><span class="string">            * test: 用于控制哪些模块被这个缓存组匹配到</span></span><br><span class="line"><span class="string">            * priority: 缓存组打包的先后优先级</span></span><br><span class="line"><span class="string">            * reuseExistingChunk: 如果当前代码块包含的模块已经有了，就不在产生一个新的代码块</span></span><br><span class="line"><span class="string">        vendor: &#123;</span></span><br><span class="line"><span class="string">          name: '</span>vendor<span class="string">',</span></span><br><span class="line"><span class="string">          chunks: '</span>initial<span class="string">',</span></span><br><span class="line"><span class="string">          priority: -10,</span></span><br><span class="line"><span class="string">          reuseExistingChunk: false,</span></span><br><span class="line"><span class="string">          test: /node_modules\/(.*)\.js/,</span></span><br><span class="line"><span class="string">          default:true/false //开启禁用default缓存组</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        styles: &#123;</span></span><br><span class="line"><span class="string">          name: '</span>styles<span class="string">',</span></span><br><span class="line"><span class="string">          test: /\.(scss|css)$/,</span></span><br><span class="line"><span class="string">          chunks: '</span>all<span class="string">',</span></span><br><span class="line"><span class="string">          minChunks: 1,</span></span><br><span class="line"><span class="string">          reuseExistingChunk: true,</span></span><br><span class="line"><span class="string">          enforce: true</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>chunks的取值是有initial, async, all。默认情况下是async，<br>initial , all 模式会将所有来自node_modules的模块分配到一个叫vendors的缓存组；所有重复引用至少两次的代码，会被分配到default的缓存组。<br><a href="https://www.codercto.com/a/26564.html" target="_blank" rel="noopener">https://www.codercto.com/a/26564.html</a> 关于配置splitChunk的一些介绍，不是很懂。</p>
<h2 id="babel-polyfill和babel-runtime区别"><a href="#babel-polyfill和babel-runtime区别" class="headerlink" title="babel-polyfill和babel-runtime区别"></a>babel-polyfill和babel-runtime区别</h2><p>babel-polyfill会有一定副作用，比如：<br>引入了新的全局对象：比如Promise、WeakMap等。<br>修改现有的全局对象：比如修改了Array、String的原型链等。<br>举个例子，我在项目中定义了跟规范不一致的Array.from()函数，同时引入了一个库（依赖babel-polyfill），<br>此时，这个库可能覆盖了自定义的Array.from()函数，导致出错。</p>
<p>babel-runtime存在的原因。它将开发者依赖的全局内置对象等，抽取成单独的模块，并通过模块导入的方式引入，避免了对全局作用域的修改（污染）。<br>因此，如果是开发库、工具，可以考虑使用 babel-runtime。</p>
<h2 id="babel-plugin-transform-runtime和-babel-runtime-区别"><a href="#babel-plugin-transform-runtime和-babel-runtime-区别" class="headerlink" title="babel-plugin-transform-runtime和 babel-runtime 区别"></a>babel-plugin-transform-runtime和 babel-runtime 区别</h2><p><a href="https://www.chyingp.com/posts/understanding-babel-runtime/" target="_blank" rel="noopener">link</a></p>
<h2 id="babel-plugin-transform-runtime"><a href="#babel-plugin-transform-runtime" class="headerlink" title="babel-plugin-transform-runtime"></a>babel-plugin-transform-runtime</h2><p>用于构建过程的代码转换,babel-runtime是实际导入项目代码的功能模块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>;     -&gt;  <span class="string">`npm bin`</span>/babel index.js</span><br><span class="line">=&gt;</span><br><span class="line"><span class="keyword">import</span> _Promise <span class="keyword">from</span> <span class="string">"babel-runtime/core-js/promise”;    //babel-runtime</span></span><br><span class="line"><span class="string">var promise = new _Promise();</span></span><br></pre></td></tr></table></figure>
<h2 id="babelrc-详解"><a href="#babelrc-详解" class="headerlink" title="babelrc 详解"></a>babelrc 详解</h2><p><a href="https://www.cnblogs.com/jiebba/p/9613248.html" target="_blank" rel="noopener">babel 用法及其 .babelrc 的配置详解，想做前端架构，拒绝一知半解</a><br><a href="https://excaliburhan.com/post/babel-preset-and-plugins.html" target="_blank" rel="noopener">如何写好.babelrc？Babel的presets和plugins配置解析</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">es2015(es6集合 )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"presets"</span>: [  <span class="comment">//presets 其实就是一堆plugins的预设起到了方便的作用 如果不采用 presets 完全可以单独引用某个功能</span></span><br><span class="line">        [<span class="string">"env"</span>,&#123; </span><br><span class="line">            “targets”:&#123; </span><br><span class="line">                “browsers”:[“last <span class="number">2</span> version”,”safari&gt;=<span class="number">7</span><span class="string">"]</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;],</span></span><br><span class="line"><span class="string">        [“es2015”],</span></span><br><span class="line"><span class="string">        [“latest”],</span></span><br><span class="line"><span class="string">        [“react"</span>]</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"plugins"</span>: [</span><br><span class="line">        <span class="string">"transform-runtime” //babel-runtime是实际导入项目代码的功能模块。转码后额外require core-js的模块如promise class等等</span></span><br><span class="line"><span class="string">        "</span>transform-es2015-classes”,</span><br><span class="line">        <span class="string">"transform-regenerator”,</span></span><br><span class="line"><span class="string">        "</span>transform-runtime<span class="string">", &#123;</span></span><br><span class="line"><span class="string">          "</span>helpers<span class="string">": true,</span></span><br><span class="line"><span class="string">          "</span>polyfill”:<span class="literal">false</span>, <span class="comment">//设置为false可以优化代码</span></span><br><span class="line">          <span class="string">"regenerator"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="string">"moduleName"</span>: <span class="string">"babel-runtime"</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">transform-runtime </span><br><span class="line"><span class="keyword">var</span> sym = <span class="built_in">Symbol</span>(); </span><br><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>( ); </span><br><span class="line"><span class="built_in">console</span>.log(arr[<span class="built_in">Symbol</span>.iterator]( ));</span><br><span class="line"></span><br><span class="line"><span class="string">"use strict”;</span></span><br><span class="line"><span class="string"> var _getIterator2 = require("</span>@babel/runtime-corejs2/core-js/get-iterator<span class="string">");</span></span><br><span class="line"><span class="string">var _getIterator3 = _interopRequireDefault(_getIterator2);</span></span><br><span class="line"><span class="string">var _promise = require("</span>@babel/runtime-corejs2/core-js/promise<span class="string">");</span></span><br><span class="line"><span class="string">var _promise2 = _interopRequireDefault(_promise);</span></span><br><span class="line"><span class="string">var _symbol = require("</span>@babel/runtime-corejs2/core-js/symbol”);</span><br><span class="line"><span class="keyword">var</span> _symbol2 = _interopRequireDefault(_symbol);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_interopRequireDefault</span>(<span class="params">obj</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> obj &amp;&amp; obj.__esModule ? obj : &#123; <span class="attr">default</span>: obj &#125;; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> sym = (<span class="number">0</span>, _symbol2.default)();</span><br><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> _promise2.default();</span><br><span class="line"><span class="built_in">console</span>.log((<span class="number">0</span>, _getIterator3.default)(arr));</span><br><span class="line"></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>
<h2 id="webpack处理css文件"><a href="#webpack处理css文件" class="headerlink" title="webpack处理css文件"></a>webpack处理css文件</h2><p>css-loader css-loader 中 importLoaders 选项的作用是，用于配置 css-loader 作用于 @import 的资源之前需要经过其他 loader 的个数。@ import 用于 css 源码中引用 其他模块的关键字，如果你的项目中确定不会涉及模块化，可以忽略此配置项。</p>
<p>style-loader 如果需要将编译后的 css文件独立导出，则须将 style-loader 替换为 extract-text­-webpack-plugin，<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm install css-loader style-loader --save-dev  </span><br><span class="line">rules: [</span><br><span class="line">    &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<h2 id="webpack处理图片文件"><a href="#webpack处理图片文件" class="headerlink" title="webpack处理图片文件"></a>webpack处理图片文件</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">npm install url-loader --save-dev <span class="comment">// 处理图片文件 </span></span><br><span class="line">npm install file-loader -D <span class="comment">//如果不正确</span></span><br><span class="line">rules: [</span><br><span class="line">    &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpe?g|gif|svg)(\?.*)?$/</span>,</span><br><span class="line">        loader: <span class="string">'url-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            limit: <span class="number">8192</span>,</span><br><span class="line">            name: path.posix.join(<span class="string">''</span>,<span class="string">'img/[name].[hash:7].[ext]'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 添加到这并且会按照文件大小, 或者转化为 base64, 或者单独作为文件</span></span><br><span class="line">        <span class="comment">//在大小限制可以name属性/[name].[ext]，会将我们的文件生成在设定的文件夹下。</span></span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="实现Npm-run-dev"><a href="#实现Npm-run-dev" class="headerlink" title="实现Npm run dev"></a>实现Npm run dev</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-dev-server -D <span class="comment">//</span></span><br><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    “build<span class="string">": "</span>webpack”, <span class="comment">//生成dict,build压缩后的文件</span></span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"webpack-dev-server --config ./webpack.config.js”//不压缩直接在线跑</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/14/reactnote/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="卡牌大叔">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卡牌大叔的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/14/reactnote/" class="post-title-link" itemprop="url">react笔记</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-14 01:19:06" itemprop="dateCreated datePublished" datetime="2018-10-14T01:19:06+08:00">2018-10-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-06-02 23:26:47" itemprop="dateModified" datetime="2019-06-02T23:26:47+08:00">2019-06-02</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="React-Link-NavLink"><a href="#React-Link-NavLink" class="headerlink" title="React Link NavLink"></a>React Link NavLink</h2><p>使用 redux-devtools-extension  会踩到action无法派发的坑，</p>
<p>const composeEnhancers = window.<strong>REDUX_DEVTOOLS_EXTENSION_COMPOSE</strong> || compose;</p>
<p>import {  createStore,compose }  from  ‘redux’;</p>
<p>const stroe =createStore(reducer,composeEnhancers());</p>
<p><a href="https://blog.csdn.net/weixin_39939012/article/details/83578289" target="_blank" rel="noopener">link</a></p>
<h2 id="如何在react框架下实现一个hashrouter"><a href="#如何在react框架下实现一个hashrouter" class="headerlink" title="如何在react框架下实现一个hashrouter"></a>如何在react框架下实现一个hashrouter</h2><p><a href="https://segmentfault.com/a/1190000014313428" target="_blank" rel="noopener">link</a><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">HashRouter</span>&gt;</span>  //错误 HashRouter不能包含多个Route子节点</span><br><span class="line">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/about"</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/topic"</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">HashRouter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Router</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/about"</span> <span class="attr">component</span>=<span class="string">&#123;About&#125;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span><br><span class="line">function Home() &#123;</span><br><span class="line">  return (</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Home<span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#123;...&#125;</span>&gt;</span>&#123;l&#125;<span class="tag">&lt;/<span class="name">Link</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="react-router4-0-简单介绍"><a href="#react-router4-0-简单介绍" class="headerlink" title="react-router4.0 简单介绍"></a>react-router4.0 简单介绍</h2><p>已经不需要配置路由，一切皆组件。</p>
<ul>
<li>react-router:提供了一些router的核心api,包括Router,Route,Switch等</li>
<li>react-router-dom:提供了BrowserRouter, HashRouter,Route,Link,NavLink</li>
</ul>
<p>react-router-dom核心用法</p>
<ul>
<li>HashRouter 和BrowserRouter</li>
<li>Route: path   exact    component  render</li>
<li>NavLink    Link</li>
<li>Switch</li>
<li>Redirect </li>
</ul>
<hr>
<h2 id="jsx如何注释？"><a href="#jsx如何注释？" class="headerlink" title="jsx如何注释？"></a>jsx如何注释？</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123; /*</span><br><span class="line">    <span class="tag">&lt;<span class="name">Menu</span> <span class="attr">theme</span>=<span class="string">"dark"</span>&gt;</span></span><br><span class="line">    &lt;SubMenu key="sub4" title=&#123;&lt;span&gt;&lt;Icon type="setting" /&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>Navigation Three<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">key</span>=<span class="string">"1"</span>&gt;</span>Option 9<span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">key</span>=<span class="string">"2"</span>&gt;</span>Option 10<span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">key</span>=<span class="string">"3"</span>&gt;</span>Option 11<span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">key</span>=<span class="string">"4"</span>&gt;</span>Option 12<span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">SubMenu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Menu</span>&gt;</span></span><br><span class="line">*/ &#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="ant-Desigin的-一些优化方案-link"><a href="#ant-Desigin的-一些优化方案-link" class="headerlink" title="ant Desigin的 一些优化方案 link"></a>ant Desigin的 一些优化方案 <a href="https://ant.design/docs/react/use-with-create-react-app-cn" target="_blank" rel="noopener">link</a></h2><p>yarn add  –save-dev less less-loadr<br>yarn add  –save-dev axios react-router</p>
<hr>
<h2 id="初识React"><a href="#初识React" class="headerlink" title="初识React"></a>初识React</h2><p><strong>如何在React项目中使用less?</strong><br><a href="https://www.jianshu.com/p/51ff1c8be301" target="_blank" rel="noopener">link</a><br><strong>npm run eject报错。如何解决?</strong><br>git add .然后git commit -m “init”  然后再npm run eject<br>React里，jsx所有的变量，表达式都在一个大括号{    }里做的。<br>相比之下，Vue比较混乱。 </p>
<hr>
<p><strong>创建react项目</strong></p>
<ol>
<li>VSCode编辑器中使用快捷键ctrl+`打开终端 </li>
<li>在终端输入create-react-app demo，自动创建名称为demo的项目 </li>
<li>cd demo进入demo项目中 </li>
<li>yarn start或yarn build运行项目</li>
<li>此时，一个React项目就搭建成功。使用VScode搭建React要简单很多，配置信息都可以省去。直接开始编写组件就可以</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/17/vuerouter/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="卡牌大叔">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卡牌大叔的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/03/17/vuerouter/" class="post-title-link" itemprop="url">VueRouter原理</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-03-17 00:00:00" itemprop="dateCreated datePublished" datetime="2018-03-17T00:00:00+08:00">2018-03-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-02-19 13:20:37" itemprop="dateModified" datetime="2019-02-19T13:20:37+08:00">2019-02-19</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Vue-router源码图"><a href="#Vue-router源码图" class="headerlink" title="Vue-router源码图"></a>Vue-router源码图</h2><p><img src="/images/vue-router.jpg" width="900"></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/09/netcontent/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="卡牌大叔">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卡牌大叔的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/03/09/netcontent/" class="post-title-link" itemprop="url">网络</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-03-09 17:37:05" itemprop="dateCreated datePublished" datetime="2018-03-09T17:37:05+08:00">2018-03-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-06-02 22:27:10" itemprop="dateModified" datetime="2019-06-02T22:27:10+08:00">2019-06-02</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="TCP报文"><a href="#TCP报文" class="headerlink" title="TCP报文"></a>TCP报文</h2><p><img src="/images/tcp.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TCP头部重要字段</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Sequence number</code> 此序号保证了TCP传输的报文都是有序的，对端可以通过序号顺序拼接报文</li>
<li><code>Acknowledgement Number</code> 此序号标识数据接收期望接收的下一个字节的编号是多少，同时也标识上一个序号的数据已经收到</li>
<li><code>Window Size</code> 窗口大小，标识还能接收多少字节的数据，用于流量控制</li>
<li>标识符<ul>
<li>RUG=1 该字段表示 数据部分包含紧急信息，是一个高优先级数据报文</li>
<li>ACK=1 该字段 在TCP建立后传送的所有报文必须把<code>ACK</code>设置为1</li>
<li>PSH=1 表示接收端应该理解将数据push给应用层</li>
<li>RST=1 表示TCP连接出现严重的问题，可能需要重新建立TCP连接 </li>
<li>SYN=1 SYN=1andACK=0表示当前报文段是一个连接的请求报文，SYN=1andACK=1表示当前报文是一个统一建立连接的应答报文</li>
<li>FIN=1 表示此此表文是一个释放连接的请求报文</li>
</ul>
</li>
</ul>
<h2 id="TCP建立连接三次握手"><a href="#TCP建立连接三次握手" class="headerlink" title="TCP建立连接三次握手"></a>TCP建立连接三次握手</h2><p><img src="/images/tcpthreehandshake.png"></p>
<ul>
<li>不管是客户端还是服务端，TCP连接建立后都能发送数据和接收数据，所以TCP是一个全双工协议</li>
<li>期初两端都是<code>closed</code>状态，通信开始，双方都会创建<code>TCB</code>。服务器创建完<code>TCB</code>都进入LISTEN状态，等待客户端发送数据</li>
</ul>
<p><strong>第一次握手</strong><br>客户端向服务端发送连接请求 <code>SYN=1</code> 报文段，该报文中包含自身的数据通讯初始序号，请求发送后，客户端进入 <code>SYN-SENT</code> 状态</p>
<p><strong>第二次次握手</strong><br>服务端接受到 <code>SYN=1</code> 报文段，如果同意连接，则会发送一个 <code>SYN=1 and ACK=1</code> 的应答，包含自身的数据通信初始序号，发送完进入 <code>SYN-RECEIVED</code> 状态</p>
<p><strong>第三次次握手</strong></p>
<ul>
<li>当客户端收到<code>SYN=1 and ACK=1</code>的同意连接的应答后，还要向服务端发送一个确认<code>ACK=1</code> 的确认报文，客户端发问后进入<code>ESTABLISHED</code> 状态。服务端接受这个应答后也进入 <code>ESTABLISHED</code> 状态，此时连接成功。</li>
</ul>
<h2 id="TCP为何建立连接需要三次握手，明明两次就可以"><a href="#TCP为何建立连接需要三次握手，明明两次就可以" class="headerlink" title="TCP为何建立连接需要三次握手，明明两次就可以"></a>TCP为何建立连接需要三次握手，明明两次就可以</h2><ul>
<li>背景，在建立连接中，任意一段掉线，TCP都会重复SYN包，一般会重试5次。TCP有超时重传机制</li>
<li>主要为了防止出现失效的连接请求报文文段被服务端接受的情况，从而产生错误</li>
<li>可以想象如下场景。客户端发送了一个连接请求 A，但是因为网络原因造成了超时，这时 TCP 会启动超时重传的机制再次发送一个连接请求 B。此时请求顺利到达服务端，服务端应答完就建立了请求，然后接收数据后释放了连接。</li>
<li>假设这时候连接请求 A 在两端关闭后终于抵达了服务端，那么此时服务端会认为客户端又需要建立 TCP 连接，二次握手的情况下，服务端应答了该请求并进入 ESTABLISHED 状态。但是客户端其实是 CLOSED 的状态，那么就会导致服务端一直等待，造成资源的浪费。</li>
</ul>
<h2 id="TCP断开四次握手"><a href="#TCP断开四次握手" class="headerlink" title="TCP断开四次握手"></a>TCP断开四次握手</h2><h2 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h2><p>特性：</p>
<ol>
<li><p>面向无连接</p>
<ul>
<li>不需要向<code>TCP</code> 一样三次握手，想发数据就可以发</li>
<li>不会对数据报文进行任何拆分和拼接操作</li>
<li>发送端：应用层将数据传递给传输层的UDP协议，只会给数据增加一个<code>UDP</code> 头标识一下是 <code>UDP</code> 协议，然后就传递给网络层了 在接收端：网络层将数据传递给传输层，<code>UDP</code> 只取出IP报文头就传递给应用层，不会做任何拼接操作</li>
</ul>
</li>
<li><p>不可靠性</p>
<ul>
<li>体现在无连接上，通信不需要建立连接，想发就发，不可靠</li>
<li>收到什么数据就传递什么数据，不会备份数据，发送数据也不关心对方是否已经接收到数据了</li>
<li>不判断网络环境，<code>UDP</code> 无阻塞控制，一直以恒定速度发送数据，不会对发送速率进行调整。弊端是网络条件不好的情况下可能会导致丢包。 对实时性要求高的场景就需要使用UDP而不是TCP</li>
</ul>
</li>
<li><p>高效<br> <img src="/images/udp.png"></p>
<ul>
<li><code>UDP</code> 头部开销小，只有8个字节，TCP二十个字节</li>
<li>不可靠，不复杂，需要保证数据不丢失有序到达</li>
<li>两个十六位的端口号，Source port分别为源端口，Destination port目标端口  length整个数据报文的长度</li>
<li>checksum整个数据报文的检测，用于发现头部信息和数据中的错误</li>
</ul>
</li>
<li>传输方式<br> <code>UDP</code> 支持一对一，一对多，多对多，多对一，提供单播，多播，广播的功能</li>
<li>适合应用场景<br> 实时性要求高的场景，直播，游戏，视频会议</li>
</ol>
<p>##TCP UDP区别</p>
<ul>
<li>不需要向<code>TCP</code> 一样三次握手，想发数据就可以发</li>
<li>TCP 建立连接断开连接都需要先进行握手,TCP 传输数据过程中，通过各种算法保证数据可靠性。没有UDP高效</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/17/howread/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="卡牌大叔">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卡牌大叔的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/02/17/howread/" class="post-title-link" itemprop="url">如何阅读源代码</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-02-17 00:00:00" itemprop="dateCreated datePublished" datetime="2018-02-17T00:00:00+08:00">2018-02-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-02-18 18:37:12" itemprop="dateModified" datetime="2019-02-18T18:37:12+08:00">2019-02-18</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>当我们阅读面前的源码时，无非有以下几种目的：</p>
<ul>
<li>纯粹学习</li>
<li>添加新功能</li>
<li>重构旧代码</li>
<li>修复他人的Bug</li>
</ul>
<p>不同的目的会有不同的心情，会影响到工作的进展，像修复他人的Bug这种事情，类似于没被掰弯的男猿捏着鼻子给另外一个男人擦屁股，是很恶心的，很容易让人拒绝的。所以因这种目标而阅读源码，往往是欲拒还迎、欲说还休，效率较低。然而修复实际工作中帮别人修复Bug这种情形，十有八九你要遇到，无可逃避。所以，心理调试很重要。</p>
<p>为了学习去读源码，这是最愉快的最放松的。不过提醒一点，设定可检验的目标才会有收获，否则就会像走到大街上看见一美女擦肩而过那样，惊艳一下下，过后嘛关系嘛收获也没了。</p>
<p>其他的目的，重构旧代码、添加新功能，比帮别人擦屁股略强，因为他带有创造性，创造性的活动能给人带来强烈的愉悦，所以虽然这两种目的也有很多让人不爽的部分，不过想到我可以让一棵老树焕发青春，不爽也就慢慢弱下去了。</p>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><p>工欲善其事必先利其器，这是亘古不变的道理。要很好的完成阅读源码的任务，我们大概需要下列这些工具：</p>
<ul>
<li>SourceInsight，最好的源码浏览工具，它能维护符号库，动态显示上下文，还能绘制调用关系图，最好的，没有之一</li>
<li>纸质笔记本，随时记录心得和疑惑，随时绘制各种图（类图、时序图、框图），比UML工具快，也比Visio快</li>
<li>中性笔</li>
<li>记事本、Notepad++、有道云笔记、为知笔记等，记录阅读源码过程中的关键点、心得体会、分析过程</li>
<li>Visio，用于绘制简单的框图，表述源码的模块划分、层次结构等</li>
<li>StartUML，用于最后绘制类图、时序图等，方便交流</li>
<li>扫描全能王（CamScanner），一款可以通过拍照达到扫描效果的App，可以用它扫描你在纸质笔记本上写下的文字，绘制的框图，分享给其他人，如果你懒得用软件绘制图标，那手绘之后扫描成电子档就最适合你了</li>
</ul>
<h2 id="知识准备"><a href="#知识准备" class="headerlink" title="知识准备"></a>知识准备</h2><p>前戏很重要，准备好了后面水到渠成快感不断，否则就会频频受挫直感道阻且长。</p>
<ul>
<li>业务基础，每一份有实际意义的源码都离不开业务，必须先对业务有概念</li>
<li>技术基础，这个源码用什么语言，什么框架，什么第三方模块，都需要先有所了解</li>
<li>文档，尽量找到业务、需求、概要、详细等文档，帮助会很大，然而，我们经常面临的情况是，只有源码，只有源码，只有源码，片言只字的文档也无，所以只好坚信——源码是最好的文档。这个心理门槛儿其实也容易过，你就想像着源码只是神仙姐姐的画像，看再多画像也不抵当面一眼效果强大——要么摧毁三观要么魂牵梦萦</li>
<li>人，搞明白哪个程序员维护过这份代码，方便后面不懂时请教，有时人家点一下顶你自己瞎琢磨一天</li>
</ul>
<h2 id="运行与开发环境"><a href="#运行与开发环境" class="headerlink" title="运行与开发环境"></a>运行与开发环境</h2><ul>
<li>配置好开发环境，目的是为了调试，对有些程序员来讲，调试是弄明白软件内部机理的最好方法，按着F5、F10、F11、F9，一切都搞定了</li>
<li>配置好运行环境，为使用软件、体验软件做准备，从用户角度，从外面看看软件到底是怎么回事，便于揣摩内部逻辑<br>笔记<br>在阅读源码的过程中，做笔记是必须的。我有这样的体会，因为代码不是自己写的，很难很快在脑子里刻下印记，经常是看着这里忘了那里，早上觉得弄懂了数据流向，中午吃个饭就忘了。所以，笔记就显得尤为重要。</li>
<li>找到适合你的记录方式，小本本、软件皆可。用软件（Notepad++、有道笔记、为知笔记等）来记录有个坏处——必须切换屏幕，会在形式上中断代码阅读过程。所以我经常在紧张得不能中断时随手用笔写些断句残章在本子上，告一段落时梳理下用软件再记录。</li>
<li>尽可能详细的记录，但不必看到什么记录什么，要间隔性的记录，比如弄明白了某个子模块的逻辑、某个类的作用、某些函数的调用关系时再记录，否则记录这个动作本身会打断思考</li>
<li>每天工作结束，记录进度（弄明白的部分），记录疑问，记录第二天要弄明白什么东西，这样你的工作状态就入栈了，第二天来了很容易出栈，快速进入工作状态</li>
<li>记录看到的优秀设计，提高审美，见贤思齐，自我成长</li>
</ul>
<h2 id="沧海遗珠"><a href="#沧海遗珠" class="headerlink" title="沧海遗珠"></a>沧海遗珠</h2><p>我在漫长的读码生涯里积攒了一些的经验，算是碎碎念，供参考：</p>
<ul>
<li>理清某一业务如何映射在代码执行流程上的，这点很关键。</li>
<li>理清不同模块间的业务关系，代码调用关系，很关键</li>
<li>调试是弄明白代码调用流程的最快方式，之一</li>
<li>找出关键代码（代表实际对象的类、衔接不同模块的类、代表业务关键节点的类）</li>
<li>分析日志可以帮助分析代码执行流程和业务流程</li>
<li>先用已有的可运行软件，体验业务，琢磨你点这里一下点那里一下代码可能是怎么做出反应的</li>
<li>阅读应该围绕目的，把实现目标放在第一位，比如修改Bug，如果有期限，在最后日期前搞定是第一要务，然后有时间就继续读源码或改进Bug修复方案，力求没有副作用和后遗症，再有时间就修修别人留下的破窗户（你也可以顺带鄙视下前任维护者）</li>
<li>千万次的问，还记得前面说要弄明白谁维护过你要读的代码吧，别不好意思，问吧，问吧，问吧</li>
<li>对着设计文档、接口文档或测试用例看代码</li>
<li>心理调试，勿畏难，别放弃。我有时看代码，看两天也不知道看了个甚，一头雾水两眼发花是常有的事儿，有时真是觉得搞不定了，然而，这要么是你基础知识没准备好，要么是你找错了入口，要知道，任何一份代码，都有一条隐形的线串着，耐心点，总会找到。这样不行就那样，多换换角度，多换换方法，读不行，就调试，调试不行，就运行，运行不行，就研究日志。</li>
<li>给自己设置小奖励，弄明白某个逻辑或某个模块的代码后奖励自己休息一下，5~10分钟，走出办公室转转，或者干脆在网上瞎逛一下，浏览自己喜欢的网站</li>
<li>读不懂才要读，想不明白才要想，这是进步和成长的开始。那些阻挡你的蹂躏你的而杀又不死你的，终将帮助你成长让你变得更强大。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">卡牌大叔</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/tedQB" title="GitHub &rarr; https://github.com/tedQB" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://weibo.com/u/5462608131" title="Weibo &rarr; https://weibo.com/u/5462608131" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://twitter.com/kapaidashu" title="Twitter &rarr; https://twitter.com/kapaidashu" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">卡牌大叔</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.0.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.0"></script>




  

  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
